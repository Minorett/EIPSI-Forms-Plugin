/**
 * EIPSI Forms - Dark Mode Toggle
 * Universal semantic dark mode system with WCAG AAA compliance
 * 
 * @package EIPSI_Forms
 * @version 3.0.0
 */

/* ========================================
    DARK MODE COLOR SYSTEM
    ======================================== */

/**
 * Dark theme colors
 * Applied when data-theme="dark" is set on .vas-dinamico-form
 * Overrides ALL --eipsi-color-* variables for complete dark mode coverage
 */
.vas-dinamico-form[data-theme="dark"],
.eipsi-form[data-theme="dark"] {
    /* Core Colors */
    --eipsi-color-primary: #60a5fa;
    --eipsi-color-primary-hover: #3b82f6;
    --eipsi-color-secondary: #1e3a8a;
    --eipsi-color-background: #0f172a;
    --eipsi-color-background-subtle: #1e293b;
    --eipsi-color-text: #e2e8f0;
    --eipsi-color-text-muted: #94a3b8;

    /* Input Colors */
    --eipsi-color-input-bg: #1e293b;
    --eipsi-color-input-text: #e2e8f0;
    --eipsi-color-input-border: #475569;
    --eipsi-color-input-border-focus: #60a5fa;
    --eipsi-color-input-error-bg: #2d1f1f;
    --eipsi-color-input-icon: #60a5fa;

    /* Button Colors */
    --eipsi-color-button-bg: #3b82f6;
    --eipsi-color-button-text: #ffffff;
    --eipsi-color-button-hover-bg: #2563eb;

    /* Semantic Colors */
    --eipsi-color-error: #fca5a5;
    --eipsi-color-success: #86efac;
    --eipsi-color-warning: #fcd34d;

    /* Border Colors */
    --eipsi-color-border: #334155;
    --eipsi-color-border-dark: #475569;

    /* Shadows (darker for dark mode) */
    --eipsi-shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
    --eipsi-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.5);
    --eipsi-shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.6);
    --eipsi-shadow-focus: 0 0 0 3px rgba(96, 165, 250, 0.3);
    --eipsi-shadow-error: 0 0 0 3px rgba(252, 165, 165, 0.3);

    /* Legacy dark mode variables (for backwards compatibility) */
    --eipsi-bg: #0f172a;
    --eipsi-surface: #1e293b;
    --eipsi-text: #e2e8f0;
    --eipsi-border: #334155;
    --eipsi-text-muted: #94a3b8;
    --eipsi-primary: #60a5fa;
    --eipsi-primary-hover: #3b82f6;

    /* ========================================
       DARK MODE v2.0 COMPLETE COVERAGE
       ======================================== */

    /* Cards & Surfaces */
    --eipsi-color-card-bg: #1e293b;
    --eipsi-color-card-bg-hover: #334155;
    --eipsi-color-card-border: #475569;
    --eipsi-color-checked-bg: rgba(96, 165, 250, 0.15);
    --eipsi-color-checked-shadow: rgba(96, 165, 250, 0.25);

    /* Success Message - Complete */
    --eipsi-color-success-dark: #059669;
    --eipsi-color-success-text: #ffffff;
    --eipsi-color-success-overlay: rgba(255, 255, 255, 0.1);
    --eipsi-color-success-subtitle: rgba(255, 255, 255, 0.95);
    --eipsi-color-success-note: rgba(255, 255, 255, 0.85);
    --eipsi-color-success-shadow: rgba(0, 0, 0, 0.3);

    /* Error Message - Complete */
    --eipsi-color-error-text: #ffffff;
    --eipsi-color-error-border-strong: rgba(255, 255, 255, 0.3);

    /* Progress Bar */
    --eipsi-color-progress-bg: #1e293b;
    --eipsi-color-progress-border: #475569;
    --eipsi-color-progress-fill: #60a5fa;
    --eipsi-color-progress-text: #e2e8f0;
    --eipsi-color-progress-text-highlight: #60a5fa;

    /* VAS Slider - CRITICAL for clinical use */
    --eipsi-color-vas-container-bg: #1e293b;
    --eipsi-color-vas-container-bg-hover: #334155;
    --eipsi-color-vas-container-border: #475569;
    --eipsi-color-vas-container-border-hover: #60a5fa;
    --eipsi-color-vas-label-bg: rgba(96, 165, 250, 0.15);
    --eipsi-color-vas-label-border: rgba(96, 165, 250, 0.3);
    --eipsi-color-vas-label-text: #60a5fa;
    --eipsi-color-vas-slider-track: #334155;
    --eipsi-color-vas-slider-track-hover: #475569;
    --eipsi-color-vas-slider-thumb: #60a5fa;
    --eipsi-color-vas-slider-thumb-secondary: #3b82f6;
    --eipsi-color-vas-slider-thumb-border: #1e293b;
    --eipsi-color-vas-value-text: #60a5fa;
    --eipsi-color-vas-value-bg: rgba(96, 165, 250, 0.1);
    --eipsi-color-vas-value-border: rgba(96, 165, 250, 0.2);

    /* Description & Info Blocks */
    --eipsi-color-description-bg: #1e293b;
    --eipsi-color-description-border: #60a5fa;
    --eipsi-color-description-text: #e2e8f0;
}

/* ========================================
    APPLY DARK MODE VARIABLES TO ALL ELEMENTS
    ======================================== */

/**
 * General form background and text
 */
.vas-dinamico-form[data-theme="dark"],
.eipsi-form[data-theme="dark"] {
    background-color: var(--eipsi-color-background);
    color: var(--eipsi-color-text);
}

/**
 * All form fields: input[text], input[email], input[number], textarea, select
 */
.vas-dinamico-form[data-theme="dark"] input[type="text"],
.vas-dinamico-form[data-theme="dark"] input[type="email"],
.vas-dinamico-form[data-theme="dark"] input[type="number"],
.vas-dinamico-form[data-theme="dark"] input[type="date"],
.vas-dinamico-form[data-theme="dark"] input[type="time"],
.vas-dinamico-form[data-theme="dark"] input[type="search"],
.vas-dinamico-form[data-theme="dark"] textarea,
.vas-dinamico-form[data-theme="dark"] select {
    background-color: var(--eipsi-color-input-bg);
    color: var(--eipsi-color-input-text);
    border-color: var(--eipsi-color-input-border);

    &:focus {
        border-color: var(--eipsi-color-input-border-focus);
        box-shadow: var(--eipsi-shadow-focus);
    }

    &:disabled {
        opacity: 0.6;
    }
}

/**
 * Labels and form text
 */
.vas-dinamico-form[data-theme="dark"] label,
.vas-dinamico-form[data-theme="dark"] .form-label {
    color: var(--eipsi-color-text);
}

/**
 * Help text and hints
 */
.vas-dinamico-form[data-theme="dark"] .help-text,
.vas-dinamico-form[data-theme="dark"] .field-hint {
    color: var(--eipsi-color-text-muted);
}

/**
 * Radio buttons and checkboxes
 */
.vas-dinamico-form[data-theme="dark"] input[type="radio"],
.vas-dinamico-form[data-theme="dark"] input[type="checkbox"] {
    border-color: var(--eipsi-color-input-border);
    background-color: var(--eipsi-color-input-bg);

    &:checked {
        background-color: var(--eipsi-color-checked-bg);
        border-color: var(--eipsi-color-primary);
        box-shadow: var(--eipsi-shadow-focus);
    }

    &:focus-visible {
        box-shadow: var(--eipsi-shadow-focus);
    }
}

/**
 * Buttons (Submit, Next, Previous, Primary, Secondary)
 */
.vas-dinamico-form[data-theme="dark"] button,
.vas-dinamico-form[data-theme="dark"] .button,
.vas-dinamico-form[data-theme="dark"] input[type="submit"],
.vas-dinamico-form[data-theme="dark"] input[type="button"] {
    background-color: var(--eipsi-color-button-bg);
    color: var(--eipsi-color-button-text);
    border: none;

    &:hover {
        background-color: var(--eipsi-color-button-hover-bg);
    }

    &:focus-visible {
        outline: 3px solid var(--eipsi-color-primary);
        outline-offset: 2px;
    }

    &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
}

/**
 * Links
 */
.vas-dinamico-form[data-theme="dark"] a {
    color: var(--eipsi-color-primary);

    &:hover {
        color: var(--eipsi-color-primary-hover);
    }

    &:focus-visible {
        outline: 3px solid var(--eipsi-color-primary);
        outline-offset: 2px;
    }
}

/**
 * Likert scale options
 */
.vas-dinamico-form[data-theme="dark"] .likert-option {
    background-color: var(--eipsi-color-card-bg);
    border-color: var(--eipsi-color-border);
    color: var(--eipsi-color-text);

    &:hover {
        background-color: var(--eipsi-color-card-bg-hover);
    }

    &.selected,
    &.checked {
        background-color: var(--eipsi-color-checked-bg);
        border-color: var(--eipsi-color-primary);
    }
}

/**
 * VAS Slider containers and components
 */
.vas-dinamico-form[data-theme="dark"] .vas-container,
.vas-dinamico-form[data-theme="dark"] .vas-slider-wrapper {
    background-color: var(--eipsi-color-vas-container-bg);
    border-color: var(--eipsi-color-vas-container-border);

    &:hover {
        background-color: var(--eipsi-color-vas-container-bg-hover);
        border-color: var(--eipsi-color-vas-container-border-hover);
    }
}

.vas-dinamico-form[data-theme="dark"] .vas-slider {
    background: var(--eipsi-color-vas-slider-track);

    &::-webkit-slider-track {
        background: var(--eipsi-color-vas-slider-track);
    }

    &::-webkit-slider-thumb {
        background: var(--eipsi-color-vas-slider-thumb);
        border-color: var(--eipsi-color-vas-slider-thumb-border);
        box-shadow: var(--eipsi-shadow-slider-thumb);
    }

    &::-moz-range-track {
        background: var(--eipsi-color-vas-slider-track);
    }

    &::-moz-range-thumb {
        background: var(--eipsi-color-vas-slider-thumb);
        border-color: var(--eipsi-color-vas-slider-thumb-border);
        box-shadow: var(--eipsi-shadow-slider-thumb);
    }
}

.vas-dinamico-form[data-theme="dark"] .vas-value-display {
    background-color: var(--eipsi-color-vas-value-bg);
    color: var(--eipsi-color-vas-value-text);
    border-color: var(--eipsi-color-vas-value-border);
}

/**
 * Modal dialogs and response details
 */
.vas-dinamico-form[data-theme="dark"] .modal,
.vas-dinamico-form[data-theme="dark"] .vas-modal-content {
    background-color: var(--eipsi-color-background-subtle);
    color: var(--eipsi-color-text);
    border-color: var(--eipsi-color-border);
}

.vas-dinamico-form[data-theme="dark"] .modal-header {
    border-bottom-color: var(--eipsi-color-border);
    color: var(--eipsi-color-text);
}

/**
 * Error and validation messages
 */
.vas-dinamico-form[data-theme="dark"] .form-error,
.vas-dinamico-form[data-theme="dark"] .error-message,
.vas-dinamico-form[data-theme="dark"] .validation-error {
    background-color: var(--eipsi-color-input-error-bg);
    color: var(--eipsi-color-error);
    border-color: var(--eipsi-color-error);
}

/**
 * Success messages
 */
.vas-dinamico-form[data-theme="dark"] .success-message {
    background-color: rgba(6, 150, 105, 0.15);
    color: var(--eipsi-color-success);
    border-color: var(--eipsi-color-success);
}

/**
 * Description and info blocks
 */
.vas-dinamico-form[data-theme="dark"] .description-block,
.vas-dinamico-form[data-theme="dark"] .field-description,
.vas-dinamico-form[data-theme="dark"] .info-block {
    background-color: var(--eipsi-color-description-bg);
    color: var(--eipsi-color-description-text);
    border-left-color: var(--eipsi-color-description-border);
}

/**
 * Thank-you page (applies variables to all elements)
 */
.vas-dinamico-form[data-theme="dark"] .eipsi-thank-you-page,
.eipsi-form[data-theme="dark"] .eipsi-thank-you-page {
    background-color: var(--eipsi-color-background);
    color: var(--eipsi-color-text);
}

.vas-dinamico-form[data-theme="dark"] .eipsi-thank-you-content,
.eipsi-form[data-theme="dark"] .eipsi-thank-you-content {
    background-color: var(--eipsi-color-background-subtle);
    border-color: var(--eipsi-color-border);
    box-shadow: var(--eipsi-shadow-md);
}

.vas-dinamico-form[data-theme="dark"] .eipsi-thank-you-title,
.eipsi-form[data-theme="dark"] .eipsi-thank-you-title {
    color: var(--eipsi-color-text);
}

.vas-dinamico-form[data-theme="dark"] .eipsi-thank-you-message,
.eipsi-form[data-theme="dark"] .eipsi-thank-you-message {
    color: var(--eipsi-color-text);
}

.vas-dinamico-form[data-theme="dark"] .eipsi-thank-you-button,
.eipsi-form[data-theme="dark"] .eipsi-thank-you-button {
    background-color: var(--eipsi-color-button-bg);
    color: var(--eipsi-color-button-text);

    &:hover {
        background-color: var(--eipsi-color-button-hover-bg);
    }

    &:focus-visible {
        outline-color: var(--eipsi-color-primary);
    }
}

/**
 * Progress bar (already has variables, ensure they're applied)
 */
.vas-dinamico-form[data-theme="dark"] .form-progress {
    background-color: var(--eipsi-color-progress-bg);
    border-color: var(--eipsi-color-progress-border);
}

.vas-dinamico-form[data-theme="dark"] .progress-bar,
.vas-dinamico-form[data-theme="dark"] .progress-fill {
    background-color: var(--eipsi-color-progress-fill);
}

.vas-dinamico-form[data-theme="dark"] .progress-text {
    color: var(--eipsi-color-progress-text);
}

.vas-dinamico-form[data-theme="dark"] .current-page {
    color: var(--eipsi-color-progress-text-highlight);
}

/**
 * Borders and separators
 */
.vas-dinamico-form[data-theme="dark"] hr,
.vas-dinamico-form[data-theme="dark"] .form-divider {
    border-color: var(--eipsi-color-border);
}

/* ========================================
   PRESET-SPECIFIC DARK MODE VARIANTS
   ======================================== */

/**
 * Clinical Blue Dark
 * Mantiene la identidad azul clínica en dark mode
 */
.vas-dinamico-form[data-theme="dark"][data-preset="Clinical Blue"],
.eipsi-form[data-theme="dark"][data-preset="Clinical Blue"] {
    /* Core Colors */
    --eipsi-color-primary: #60a5fa;
    --eipsi-color-primary-hover: #3b82f6;
    --eipsi-color-background: #0f172a;
    --eipsi-color-background-subtle: #1e293b;
    
    /* VAS Slider - Blue variant */
    --eipsi-color-vas-container-bg: #1e3a5c;
    --eipsi-color-vas-container-bg-hover: #2d4a73;
    --eipsi-color-vas-container-border: #3b5a8a;
    --eipsi-color-vas-container-border-hover: #4a6fa0;
    --eipsi-color-vas-label-bg: rgba(96, 165, 250, 0.15);
    --eipsi-color-vas-label-text: #60a5fa;
    --eipsi-color-vas-slider-thumb: #60a5fa;
}

/**
 * Minimal White Dark
 * Versión minimalista con grises neutros
 */
.vas-dinamico-form[data-theme="dark"][data-preset="Minimal White"],
.eipsi-form[data-theme="dark"][data-preset="Minimal White"] {
    /* Core Colors */
    --eipsi-color-primary: #94a3b8;
    --eipsi-color-primary-hover: #cbd5e1;
    --eipsi-color-background: #0f172a;
    --eipsi-color-text: #f1f5f9;
    
    /* Button Colors */
    --eipsi-color-button-bg: #475569;
    --eipsi-color-button-hover-bg: #1e293b;
    
    /* VAS Slider - Neutral variant */
    --eipsi-color-vas-label-text: #94a3b8;
    --eipsi-color-vas-slider-thumb: #94a3b8;
    --eipsi-color-vas-value-text: #94a3b8;
}

/**
 * Warm Neutral Dark
 * Mantiene tonos cálidos incluso en dark mode
 */
.vas-dinamico-form[data-theme="dark"][data-preset="Warm Neutral"],
.eipsi-form[data-theme="dark"][data-preset="Warm Neutral"] {
    /* Core Colors */
    --eipsi-color-primary: #d4b896;
    --eipsi-color-primary-hover: #e5c9a5;
    --eipsi-color-background: #1a1714;
    --eipsi-color-background-subtle: #252118;
    --eipsi-color-text: #e8e3db;
    --eipsi-color-text-muted: #a39889;
    
    /* Button Colors */
    --eipsi-color-button-bg: #8b6f47;
    --eipsi-color-button-hover-bg: #6b5437;
    
    /* Border Colors */
    --eipsi-color-border: #4a3f2f;
    --eipsi-color-border-dark: #6b5437;
    
    /* VAS Slider - Warm variant */
    --eipsi-color-vas-label-text: #d4b896;
    --eipsi-color-vas-slider-thumb: #d4b896;
    --eipsi-color-vas-value-text: #d4b896;
    --eipsi-color-vas-label-bg: rgba(212, 184, 150, 0.15);
}

/**
 * Serene Teal Dark
 * Mantiene la serenidad teal en modo nocturno
 */
.vas-dinamico-form[data-theme="dark"][data-preset="Serene Teal"],
.eipsi-form[data-theme="dark"][data-preset="Serene Teal"] {
    /* Core Colors */
    --eipsi-color-primary: #5eead4;
    --eipsi-color-primary-hover: #2dd4bf;
    --eipsi-color-background: #0c1821;
    --eipsi-color-background-subtle: #164e63;
    --eipsi-color-text: #e0f2fe;
    
    /* Button Colors */
    --eipsi-color-button-bg: #0e7490;
    --eipsi-color-button-hover-bg: #155e75;
    
    /* Border Colors */
    --eipsi-color-border: #155e75;
    --eipsi-color-border-dark: #0e7490;
    
    /* VAS Slider - Teal variant */
    --eipsi-color-vas-label-text: #5eead4;
    --eipsi-color-vas-slider-thumb: #5eead4;
    --eipsi-color-vas-value-text: #5eead4;
    --eipsi-color-vas-label-bg: rgba(94, 234, 212, 0.15);
}

/* ========================================
   SMOOTH TRANSITIONS
   ======================================== */

/**
 * Apply smooth transitions to all theme-aware elements
 * Improves perceived performance and UX
 */
.eipsi-form,
.eipsi-form * {
    transition:
        background-color 0.3s ease,
        border-color 0.3s ease,
        color 0.3s ease,
        box-shadow 0.3s ease;
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    .eipsi-form,
    .eipsi-form * {
        transition-duration: 0.01ms !important;
    }
}

/* ========================================
   TOGGLE BUTTON STYLES
   ======================================== */

/**
 * Base toggle button
 * Used across header, footer, and mobile fixed position
 */
.eipsi-toggle {
    padding: 10px 16px;
    border-radius: 6px;
    border: 2px solid var(--eipsi-primary, #005a87);
    background: var(--eipsi-primary, #005a87);
    color: #ffffff;
    font-size: 13px;
    font-weight: 600;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    line-height: 1;
    white-space: nowrap;

    /* Hover state */
    &:hover {
        background: var(--eipsi-primary-hover, #003d5b);
        border-color: var(--eipsi-primary-hover, #003d5b);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 90, 135, 0.3);
    }

    /* Focus state - WCAG AAA */
    &:focus-visible {
        outline: 3px solid var(--eipsi-primary, #005a87);
        outline-offset: 2px;
        box-shadow: 0 0 0 4px rgba(0, 90, 135, 0.2);
    }

    /* Active state */
    &:active {
        transform: translateY(0);
    }

    /* Loading state */
    &.eipsi-toggle--loading {
        opacity: 0.7;
        pointer-events: none;
        transform: scale(0.95);
    }

    /* Disabled state */
    &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
}

/* ========================================
   HEADER PLACEMENT & TOGGLE
   ======================================== */

/**
 * Header container with toggle
 * Responsive: inline on desktop/tablet, fixed on mobile
 */
.eipsi-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--eipsi-color-border, var(--eipsi-border, #64748b));

    h2 {
        color: var(--eipsi-color-text, var(--eipsi-text, #2c3e50));
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
    }

    /* Toggle button in header - inline by default */
    .eipsi-toggle {
        position: relative;
    }

    /* On mobile: make toggle fixed in bottom-right corner */
    @media (max-width: 768px) {
        .eipsi-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            width: 48px;
            height: 48px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);

            /* Enhanced focus for mobile */
            &:focus-visible {
                outline: 4px solid var(--eipsi-color-primary, var(--eipsi-primary, #005a87));
                outline-offset: 3px;
            }
        }
    }

    /* On small mobile: adjust position */
    @media (max-width: 480px) {
        .eipsi-toggle {
            bottom: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            font-size: 18px;
        }
    }
}

/* ========================================
   NOSCRIPT FALLBACK
   ======================================== */

/**
 * Hide toggle when JavaScript is disabled
 * Graceful degradation for accessibility
 */
noscript .eipsi-header .eipsi-toggle {
    display: none !important;
}

/* ========================================
   RESPONSIVE ADJUSTMENTS
   ======================================== */

/* Tablet adjustments */
@media (max-width: 1024px) {
    .eipsi-header {
        padding-bottom: 12px;

        h2 {
            font-size: 1.35rem;
        }

        .eipsi-toggle {
            padding: 8px 14px;
            font-size: 12px;
        }
    }
}

/* Mobile adjustments */
@media (max-width: 768px) {
    .eipsi-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;

        h2 {
            font-size: 1.25rem;
        }
    }
}

/* ========================================
   HIGH CONTRAST MODE SUPPORT
   ======================================== */

/**
 * Enhance visibility in Windows High Contrast Mode
 * System-level accessibility feature
 */
@media (prefers-contrast: high) {
    .eipsi-toggle {
        border-width: 3px;
        font-weight: 700;
    }

    .eipsi-header {
        border-bottom-width: 3px;
    }
}

/* ========================================
   PRINT STYLES
   ======================================== */

/**
 * Hide toggle control in print
 */
@media print {
    .eipsi-header .eipsi-toggle {
        display: none !important;
    }
}
