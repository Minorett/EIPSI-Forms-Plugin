(()=>{var e,i={348:(e,i,s)=>{"use strict";const o=window.wp.blocks,a=window.wp.blockEditor,t=window.wp.components,r=window.wp.i18n,n=window.wp.data,l=window.wp.htmlEntities,c=window.wp.serverSideRender;var d=s.n(c);const p=window.wp.element,m=window.ReactJSXRuntime;(0,o.registerBlockType)("eipsi/form-block",{edit:({attributes:e,setAttributes:i})=>{const{templateId:s}=e,o=(0,a.useBlockProps)(),c=(0,p.useMemo)(()=>({per_page:-1,status:"publish",orderby:"title",order:"asc"}),[]),{formTemplates:u,isLoading:f}=(0,n.useSelect)(e=>{const i=e("core"),s=e("core/data");return{formTemplates:i?.getEntityRecords("postType","eipsi_form_template",c)||[],isLoading:s?.isResolving("core","getEntityRecords",["postType","eipsi_form_template",c])}},[c]),h=(0,p.useMemo)(()=>[{label:(0,r.__)("‚Äî Seleccion√° un formulario ‚Äî","eipsi-forms"),value:""},...u.map(e=>({label:(0,l.decodeEntities)(e.title.rendered)||(0,r.__)("(Sin t√≠tulo)","eipsi-forms"),value:String(e.id)}))],[u]);return(0,m.jsxs)("div",{...o,children:[(0,m.jsx)(a.InspectorControls,{children:(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Configuraci√≥n del formulario","eipsi-forms"),initialOpen:!0,children:[f&&(0,m.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,m.jsx)(t.Spinner,{}),(0,m.jsx)("p",{style:{marginTop:"10px",color:"#666"},children:(0,r.__)("Cargando formularios‚Ä¶","eipsi-forms")})]}),!f&&0===u.length&&(0,m.jsxs)("div",{style:{padding:"12px",background:"#f0f0f1",borderRadius:"4px"},children:[(0,m.jsx)("p",{style:{margin:0,fontSize:"13px",color:"#666"},children:(0,r.__)("No hay formularios creados a√∫n.","eipsi-forms")}),(0,m.jsx)("p",{style:{margin:"8px 0 0",fontSize:"13px"},children:(0,m.jsx)("a",{href:"/wp-admin/post-new.php?post_type=eipsi_form_template",target:"_blank",children:(0,r.__)("+ Crear tu primer formulario","eipsi-forms")})})]}),!f&&u.length>0&&(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Formulario a mostrar","eipsi-forms"),value:s?String(s):"",options:h,onChange:e=>i({templateId:e?parseInt(e,10):0}),help:(0,r.__)("Eleg√≠ un formulario de la librer√≠a para mostrarlo en esta p√°gina.","eipsi-forms")})]})}),s?(0,m.jsx)(d(),{block:"eipsi/form-block",attributes:e}):(0,m.jsx)("div",{className:"eipsi-form-placeholder",children:(0,m.jsxs)("div",{className:"components-placeholder",children:[(0,m.jsx)("div",{className:"components-placeholder__label",children:(0,r.__)("Formulario EIPSI","eipsi-forms")}),(0,m.jsx)("div",{className:"components-placeholder__instructions",children:(0,r.__)("Seleccion√° un formulario de la librer√≠a en la configuraci√≥n del bloque ‚Üí","eipsi-forms")})]})})]})},save:()=>null});const u={colors:{primary:"#005a87",primaryHover:"#003d5b",secondary:"#e3f2fd",background:"#ffffff",backgroundSubtle:"#f8f9fa",text:"#2c3e50",textMuted:"#64748b",inputBg:"#ffffff",inputText:"#2c3e50",inputBorder:"#64748b",inputBorderFocus:"#005a87",inputErrorBg:"#fff5f5",inputIcon:"#005a87",buttonBg:"#005a87",buttonText:"#ffffff",buttonHoverBg:"#003d5b",error:"#d32f2f",success:"#198754",warning:"#b35900",border:"#64748b",borderDark:"#475569"},typography:{fontFamilyHeading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontFamilyBody:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontSizeBase:"16px",fontSizeH1:"2rem",fontSizeH2:"1.75rem",fontSizeH3:"1.5rem",fontSizeSmall:"0.875rem",fontWeightNormal:"400",fontWeightMedium:"500",fontWeightBold:"700",lineHeightBase:"1.6",lineHeightHeading:"1.3"},spacing:{xs:"0.5rem",sm:"1rem",md:"1.5rem",lg:"2rem",xl:"2.5rem",containerPadding:"2.5rem",fieldGap:"1.5rem",sectionGap:"2rem"},borders:{radiusSm:"8px",radiusMd:"12px",radiusLg:"20px",width:"1px",widthFocus:"2px",style:"solid"},shadows:{sm:"0 2px 8px rgba(0, 90, 135, 0.08)",md:"0 4px 12px rgba(0, 90, 135, 0.1)",lg:"0 8px 25px rgba(0, 90, 135, 0.1)",focus:"0 0 0 3px rgba(0, 90, 135, 0.1)",error:"0 0 0 3px rgba(211, 47, 47, 0.15)"},interactivity:{transitionDuration:"0.2s",transitionTiming:"ease",hoverScale:"1.02",focusOutlineWidth:"2px",focusOutlineOffset:"2px"}};function f(e){if(e.styleConfig&&"object"==typeof e.styleConfig)return e.styleConfig;const i=JSON.parse(JSON.stringify(u));return e.backgroundColor&&(i.colors.background=e.backgroundColor),e.textColor&&(i.colors.text=e.textColor),e.primaryColor&&(i.colors.primary=e.primaryColor,i.colors.buttonBg=e.primaryColor),e.inputBgColor&&(i.colors.inputBg=e.inputBgColor),e.inputTextColor&&(i.colors.inputText=e.inputTextColor),e.buttonBgColor&&(i.colors.buttonBg=e.buttonBgColor),e.buttonTextColor&&(i.colors.buttonText=e.buttonTextColor),void 0!==e.borderRadius&&(i.borders.radiusMd=`${e.borderRadius}px`),void 0!==e.padding&&(i.spacing.containerPadding=`${e.padding}px`),i}function h(e){const i=e||u;return{"--eipsi-color-primary":i.colors.primary,"--eipsi-color-primary-hover":i.colors.primaryHover,"--eipsi-color-secondary":i.colors.secondary,"--eipsi-color-background":i.colors.background,"--eipsi-color-background-subtle":i.colors.backgroundSubtle,"--eipsi-color-text":i.colors.text,"--eipsi-color-text-muted":i.colors.textMuted,"--eipsi-color-input-bg":i.colors.inputBg,"--eipsi-color-input-text":i.colors.inputText,"--eipsi-color-input-border":i.colors.inputBorder,"--eipsi-color-input-border-focus":i.colors.inputBorderFocus,"--eipsi-color-input-error-bg":i.colors.inputErrorBg,"--eipsi-color-input-icon":i.colors.inputIcon,"--eipsi-color-button-bg":i.colors.buttonBg,"--eipsi-color-button-text":i.colors.buttonText,"--eipsi-color-button-hover-bg":i.colors.buttonHoverBg,"--eipsi-color-error":i.colors.error,"--eipsi-color-success":i.colors.success,"--eipsi-color-warning":i.colors.warning,"--eipsi-color-border":i.colors.border,"--eipsi-color-border-dark":i.colors.borderDark,"--eipsi-font-family-heading":i.typography.fontFamilyHeading,"--eipsi-font-family-body":i.typography.fontFamilyBody,"--eipsi-font-size-base":i.typography.fontSizeBase,"--eipsi-font-size-h1":i.typography.fontSizeH1,"--eipsi-font-size-h2":i.typography.fontSizeH2,"--eipsi-font-size-h3":i.typography.fontSizeH3,"--eipsi-font-size-small":i.typography.fontSizeSmall,"--eipsi-font-weight-normal":i.typography.fontWeightNormal,"--eipsi-font-weight-medium":i.typography.fontWeightMedium,"--eipsi-font-weight-bold":i.typography.fontWeightBold,"--eipsi-line-height-base":i.typography.lineHeightBase,"--eipsi-line-height-heading":i.typography.lineHeightHeading,"--eipsi-spacing-xs":i.spacing.xs,"--eipsi-spacing-sm":i.spacing.sm,"--eipsi-spacing-md":i.spacing.md,"--eipsi-spacing-lg":i.spacing.lg,"--eipsi-spacing-xl":i.spacing.xl,"--eipsi-spacing-container-padding":i.spacing.containerPadding,"--eipsi-spacing-field-gap":i.spacing.fieldGap,"--eipsi-spacing-section-gap":i.spacing.sectionGap,"--eipsi-border-radius-sm":i.borders.radiusSm,"--eipsi-border-radius-md":i.borders.radiusMd,"--eipsi-border-radius-lg":i.borders.radiusLg,"--eipsi-border-width":i.borders.width,"--eipsi-border-width-focus":i.borders.widthFocus,"--eipsi-border-style":i.borders.style,"--eipsi-shadow-sm":i.shadows.sm,"--eipsi-shadow-md":i.shadows.md,"--eipsi-shadow-lg":i.shadows.lg,"--eipsi-shadow-focus":i.shadows.focus,"--eipsi-shadow-error":i.shadows.error,"--eipsi-transition-duration":i.interactivity.transitionDuration,"--eipsi-transition-timing":i.interactivity.transitionTiming,"--eipsi-hover-scale":i.interactivity.hoverScale,"--eipsi-focus-outline-width":i.interactivity.focusOutlineWidth,"--eipsi-focus-outline-offset":i.interactivity.focusOutlineOffset}}function g(e){if(!e||"string"!=typeof e)return null;const i=e.trim();if(i.startsWith("#"))return function(e){const i=e.replace(/^#/,"");let s,o,a;if(3===i.length)s=parseInt(i[0]+i[0],16),o=parseInt(i[1]+i[1],16),a=parseInt(i[2]+i[2],16);else{if(6!==i.length)return null;s=parseInt(i.substring(0,2),16),o=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16)}return{r:s,g:o,b:a}}(i);const s=i.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);return s?{r:parseInt(s[1],10),g:parseInt(s[2],10),b:parseInt(s[3],10)}:null}function x(e){if(!e)return 0;const i=e.r/255,s=e.g/255,o=e.b/255;return.2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}function b(e,i){const s=function(e,i){const s=g(e),o=g(i);if(!s||!o)return 0;const a=x(s),t=x(o);return(Math.max(a,t)+.05)/(Math.min(a,t)+.05)}(e,i);return s>=7?{passes:!0,level:"AAA",ratio:s.toFixed(2),message:"Excellent contrast (WCAG AAA)"}:s>=4.5?{passes:!0,level:"AA",ratio:s.toFixed(2),message:"Good contrast (WCAG AA)"}:{passes:!1,level:"Fail",ratio:s.toFixed(2),message:`Insufficient contrast (${s.toFixed(2)}:1). Minimum 4.5:1 required for accessibility.`}}const _=[{name:"Clinical Blue",description:"Professional medical research with balanced design and EIPSI blue branding",config:{...u}},{name:"Minimal White",description:"Ultra-clean minimalist design with sharp lines and abundant white space",config:{colors:{primary:"#475569",primaryHover:"#1e293b",secondary:"#f8fafc",background:"#ffffff",backgroundSubtle:"#fafbfc",text:"#0f172a",textMuted:"#556677",inputBg:"#ffffff",inputText:"#0f172a",inputBorder:"#64748b",inputBorderFocus:"#475569",inputErrorBg:"#fef2f2",inputIcon:"#475569",buttonBg:"#475569",buttonText:"#ffffff",buttonHoverBg:"#1e293b",error:"#c53030",success:"#28744c",warning:"#b35900",border:"#64748b",borderDark:"#475569"},typography:{fontFamilyHeading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontFamilyBody:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSizeBase:"16px",fontSizeH1:"1.875rem",fontSizeH2:"1.5rem",fontSizeH3:"1.25rem",fontSizeSmall:"0.875rem",fontWeightNormal:"400",fontWeightMedium:"500",fontWeightBold:"600",lineHeightBase:"1.7",lineHeightHeading:"1.25"},spacing:{xs:"0.75rem",sm:"1.25rem",md:"2rem",lg:"2.75rem",xl:"4rem",containerPadding:"3.5rem",fieldGap:"2rem",sectionGap:"3rem"},borders:{radiusSm:"4px",radiusMd:"6px",radiusLg:"8px",width:"1px",widthFocus:"2px",style:"solid"},shadows:{sm:"none",md:"none",lg:"none",focus:"0 0 0 3px rgba(71, 85, 105, 0.15)",error:"0 0 0 3px rgba(197, 48, 48, 0.15)"},interactivity:{transitionDuration:"0.15s",transitionTiming:"ease",hoverScale:"1",focusOutlineWidth:"2px",focusOutlineOffset:"2px"}}},{name:"Warm Neutral",description:"Warm and approachable with rounded corners and inviting serif typography",config:{colors:{primary:"#8b6f47",primaryHover:"#6b5437",secondary:"#f5f1eb",background:"#fdfcfa",backgroundSubtle:"#f7f4ef",text:"#3d3935",textMuted:"#6b6560",inputBg:"#ffffff",inputText:"#3d3935",inputBorder:"#8b7a65",inputBorderFocus:"#8b6f47",inputErrorBg:"#fff5f5",inputIcon:"#8b6f47",buttonBg:"#8b6f47",buttonText:"#ffffff",buttonHoverBg:"#6b5437",error:"#c53030",success:"#2a7850",warning:"#b04d1f",border:"#8b7a65",borderDark:"#6b5437"},typography:{fontFamilyHeading:'Georgia, "Times New Roman", serif',fontFamilyBody:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSizeBase:"16px",fontSizeH1:"2rem",fontSizeH2:"1.75rem",fontSizeH3:"1.5rem",fontSizeSmall:"0.875rem",fontWeightNormal:"400",fontWeightMedium:"500",fontWeightBold:"700",lineHeightBase:"1.7",lineHeightHeading:"1.35"},spacing:{xs:"0.5rem",sm:"1rem",md:"1.5rem",lg:"2rem",xl:"2.5rem",containerPadding:"2.5rem",fieldGap:"1.75rem",sectionGap:"2.25rem"},borders:{radiusSm:"10px",radiusMd:"14px",radiusLg:"20px",width:"1px",widthFocus:"2px",style:"solid"},shadows:{sm:"0 2px 8px rgba(139, 111, 71, 0.08)",md:"0 4px 12px rgba(139, 111, 71, 0.12)",lg:"0 8px 25px rgba(139, 111, 71, 0.15)",focus:"0 0 0 3px rgba(139, 111, 71, 0.15)",error:"0 0 0 3px rgba(197, 48, 48, 0.15)"},interactivity:{transitionDuration:"0.25s",transitionTiming:"ease-out",hoverScale:"1.01",focusOutlineWidth:"2px",focusOutlineOffset:"2px"}}},{name:"Serene Teal",description:"Calming teal tones with balanced design for therapeutic assessments",config:{colors:{primary:"#0e7490",primaryHover:"#155e75",secondary:"#e0f2fe",background:"#ffffff",backgroundSubtle:"#f0f9ff",text:"#0c4a6e",textMuted:"#475569",inputBg:"#ffffff",inputText:"#0c4a6e",inputBorder:"#0891b2",inputBorderFocus:"#0e7490",inputErrorBg:"#fef2f2",inputIcon:"#0e7490",buttonBg:"#0e7490",buttonText:"#ffffff",buttonHoverBg:"#155e75",error:"#dc2626",success:"#047857",warning:"#b35900",border:"#0891b2",borderDark:"#0e7490"},typography:{fontFamilyHeading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontFamilyBody:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',fontSizeBase:"16px",fontSizeH1:"2rem",fontSizeH2:"1.625rem",fontSizeH3:"1.375rem",fontSizeSmall:"0.875rem",fontWeightNormal:"400",fontWeightMedium:"500",fontWeightBold:"600",lineHeightBase:"1.65",lineHeightHeading:"1.3"},spacing:{xs:"0.5rem",sm:"1rem",md:"1.75rem",lg:"2.25rem",xl:"3rem",containerPadding:"2.75rem",fieldGap:"1.75rem",sectionGap:"2.5rem"},borders:{radiusSm:"10px",radiusMd:"16px",radiusLg:"24px",width:"1px",widthFocus:"2px",style:"solid"},shadows:{sm:"0 2px 8px rgba(8, 145, 178, 0.08)",md:"0 4px 12px rgba(8, 145, 178, 0.1)",lg:"0 8px 24px rgba(8, 145, 178, 0.12)",focus:"0 0 0 3px rgba(8, 145, 178, 0.2)",error:"0 0 0 3px rgba(220, 38, 38, 0.15)"},interactivity:{transitionDuration:"0.25s",transitionTiming:"ease-out",hoverScale:"1.015",focusOutlineWidth:"2px",focusOutlineOffset:"2px"}}}],y=({styleConfig:e,setStyleConfig:i,presetName:s,setPresetName:o})=>{const[a,n]=(0,p.useState)(s||null),l=e||u,c=(e,s,o)=>{const a={...l,[e]:{...l[e],[s]:o}};i(a),n(null)},d=b(l.colors.text,l.colors.background),f=b(l.colors.textMuted,l.colors.backgroundSubtle),h=b(l.colors.buttonText,l.colors.buttonBg),g=b(l.colors.buttonText,l.colors.buttonHoverBg),x=b(l.colors.inputText,l.colors.inputBg),y=b(l.colors.error,l.colors.background),v=b(l.colors.success,l.colors.background),j=b(l.colors.warning,l.colors.background),C=[{name:"EIPSI Blue",color:"#005a87"},{name:"Dark Blue",color:"#003d5b"},{name:"Light Blue",color:"#e3f2fd"},{name:"Navy",color:"#2c5aa0"},{name:"White",color:"#ffffff"},{name:"Light Gray",color:"#f8f9fa"},{name:"Dark Gray",color:"#2c3e50"},{name:"Medium Gray",color:"#64748b"},{name:"Border Gray",color:"#e2e8f0"},{name:"Black",color:"#000000"},{name:"Error Red (WCAG AA)",color:"#d32f2f"},{name:"Success Green (WCAG AA)",color:"#198754"},{name:"Warning Brown (WCAG AA)",color:"#b35900"},{name:"Warm Brown",color:"#8b6f47"}],w=[{label:"System Default",value:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},{label:"Arial",value:"Arial, sans-serif"},{label:"Helvetica",value:"Helvetica, Arial, sans-serif"},{label:"Georgia (Serif)",value:'Georgia, "Times New Roman", serif'},{label:"Times New Roman",value:'"Times New Roman", serif'},{label:"Courier New (Mono)",value:'"Courier New", monospace'},{label:"Verdana",value:"Verdana, sans-serif"}];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üé® Theme Presets","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Apply professionally designed themes optimized for clinical research.","eipsi-forms")}),(0,m.jsx)("div",{className:"eipsi-preset-grid",children:_.map(e=>{const s=function(e){return{primary:e.config.colors.primary,background:e.config.colors.background,backgroundSubtle:e.config.colors.backgroundSubtle,text:e.config.colors.text,border:e.config.colors.border,buttonBg:e.config.colors.buttonBg,buttonText:e.config.colors.buttonText,borderRadius:e.config.borders.radiusMd,shadow:e.config.shadows.md,fontFamily:e.config.typography.fontFamilyHeading}}(e),r=a===e.name;return(0,m.jsxs)("button",{className:"eipsi-preset-button "+(r?"is-active":""),onClick:()=>(e=>{i(JSON.parse(JSON.stringify(e.config))),n(e.name),o(e.name)})(e),title:e.description,children:[(0,m.jsxs)("div",{className:"eipsi-preset-preview",style:{background:s.backgroundSubtle,borderColor:s.border,borderRadius:s.borderRadius,boxShadow:s.shadow},children:[(0,m.jsx)("div",{className:"eipsi-preset-button-sample",style:{background:s.buttonBg,color:s.buttonText,borderRadius:s.borderRadius},children:"Button"}),(0,m.jsx)("div",{className:"eipsi-preset-text",style:{color:s.text,fontFamily:s.fontFamily},children:"Text"})]}),(0,m.jsx)("span",{className:"eipsi-preset-name",children:e.name}),r&&(0,m.jsx)(t.Dashicon,{icon:"yes-alt",className:"eipsi-preset-checkmark"})]},e.name)})}),(0,m.jsx)(t.Button,{isSecondary:!0,isSmall:!0,onClick:()=>{window.confirm((0,r.__)("Reset all customizations to default clinical theme?","eipsi-forms"))&&(i(JSON.parse(JSON.stringify(u))),n("Clinical Blue"),o("Clinical Blue"))},style:{marginTop:"1rem",width:"100%"},children:(0,r.__)("Reset to Default","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üé® Colors","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Customize form colors. Maintain 4.5:1 contrast ratio for accessibility.","eipsi-forms")}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Brand Colors","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Primary","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.primary})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.primary,onChange:e=>c("colors","primary",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Primary Hover","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.primaryHover})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.primaryHover,onChange:e=>c("colors","primaryHover",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Secondary","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.secondary})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.secondary,onChange:e=>c("colors","secondary",e),clearable:!1})]}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Background & Text","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Background","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.background})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.background,onChange:e=>c("colors","background",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Text","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.text})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.text,onChange:e=>c("colors","text",e),clearable:!1})]}),!d.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",d.message]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Text Muted","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.textMuted})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.textMuted,onChange:e=>c("colors","textMuted",e),clearable:!1})]}),!f.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",(0,r.__)("Text Muted on Background Subtle:","eipsi-forms"),f.message]}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Input Fields","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Input Background","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.inputBg})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.inputBg,onChange:e=>c("colors","inputBg",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Input Text","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.inputText})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.inputText,onChange:e=>c("colors","inputText",e),clearable:!1})]}),!x.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",x.message]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Input Border","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.inputBorder})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.inputBorder,onChange:e=>c("colors","inputBorder",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Input Border (Focus)","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.inputBorderFocus})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.inputBorderFocus,onChange:e=>c("colors","inputBorderFocus",e),clearable:!1})]}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Buttons","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Button Background","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.buttonBg})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.buttonBg,onChange:e=>c("colors","buttonBg",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Button Text","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.buttonText})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.buttonText,onChange:e=>c("colors","buttonText",e),clearable:!1})]}),!h.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",h.message]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Button Hover","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.buttonHoverBg})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.buttonHoverBg,onChange:e=>c("colors","buttonHoverBg",e),clearable:!1})]}),!g.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",(0,r.__)("Button Text on Hover Background:","eipsi-forms"),g.message]}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Status & Feedback","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Error","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.error})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.error,onChange:e=>c("colors","error",e),clearable:!1})]}),!y.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",(0,r.__)("Error messages must be readable.","eipsi-forms"),y.message]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Success","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.success})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.success,onChange:e=>c("colors","success",e),clearable:!1})]}),!v.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",(0,r.__)("Success messages must be readable.","eipsi-forms"),v.message]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Warning","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.warning})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.warning,onChange:e=>c("colors","warning",e),clearable:!1})]}),!j.passes&&(0,m.jsxs)(t.Notice,{status:"warning",isDismissible:!1,children:[(0,m.jsx)("strong",{children:(0,r.__)("Contrast Warning:","eipsi-forms")})," ",(0,r.__)("Warning messages must be readable.","eipsi-forms"),j.message]}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Borders","eipsi-forms")}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Border","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.border})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.border,onChange:e=>c("colors","border",e),clearable:!1})]}),(0,m.jsxs)("div",{className:"eipsi-color-control",children:[(0,m.jsxs)(t.Flex,{align:"flex-start",justify:"space-between",children:[(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)("label",{children:(0,r.__)("Border Dark","eipsi-forms")})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.ColorIndicator,{colorValue:l.colors.borderDark})})]}),(0,m.jsx)(t.ColorPalette,{colors:C,value:l.colors.borderDark,onChange:e=>c("colors","borderDark",e),clearable:!1})]})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("‚úçÔ∏è Typography","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Configure font families and sizes for optimal readability.","eipsi-forms")}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Font Families","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Heading Font","eipsi-forms"),value:l.typography.fontFamilyHeading,options:w,onChange:e=>c("typography","fontFamilyHeading",e)}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Body Font","eipsi-forms"),value:l.typography.fontFamilyBody,options:w,onChange:e=>c("typography","fontFamilyBody",e)}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Font Sizes","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Base Size","eipsi-forms"),value:l.typography.fontSizeBase,onChange:e=>c("typography","fontSizeBase",e),help:(0,r.__)("Recommended: 16px minimum for accessibility","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Heading 1 Size","eipsi-forms"),value:l.typography.fontSizeH1,onChange:e=>c("typography","fontSizeH1",e)}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Heading 2 Size","eipsi-forms"),value:l.typography.fontSizeH2,onChange:e=>c("typography","fontSizeH2",e)}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Heading 3 Size","eipsi-forms"),value:l.typography.fontSizeH3,onChange:e=>c("typography","fontSizeH3",e)}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Small Text Size","eipsi-forms"),value:l.typography.fontSizeSmall,onChange:e=>c("typography","fontSizeSmall",e)}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Font Weights","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Normal Weight","eipsi-forms"),value:parseInt(l.typography.fontWeightNormal),onChange:e=>c("typography","fontWeightNormal",String(e)),min:100,max:900,step:100}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Medium Weight","eipsi-forms"),value:parseInt(l.typography.fontWeightMedium),onChange:e=>c("typography","fontWeightMedium",String(e)),min:100,max:900,step:100}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Bold Weight","eipsi-forms"),value:parseInt(l.typography.fontWeightBold),onChange:e=>c("typography","fontWeightBold",String(e)),min:100,max:900,step:100}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Line Heights","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Base Line Height","eipsi-forms"),value:l.typography.lineHeightBase,onChange:e=>c("typography","lineHeightBase",e),help:(0,r.__)("Recommended: 1.6‚Äì1.8 for comfortable reading","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Heading Line Height","eipsi-forms"),value:l.typography.lineHeightHeading,onChange:e=>c("typography","lineHeightHeading",e)})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üìê Spacing & Layout","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Control spacing for participant comfort and visual hierarchy.","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Container Padding","eipsi-forms"),value:parseFloat(l.spacing.containerPadding),onChange:e=>c("spacing","containerPadding",`${e}rem`),min:0,max:5,step:.25,help:(0,r.__)("Breathing room around form content","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Field Gap","eipsi-forms"),value:parseFloat(l.spacing.fieldGap),onChange:e=>c("spacing","fieldGap",`${e}rem`),min:.5,max:4,step:.25,help:(0,r.__)("Vertical spacing between form fields","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Section Gap","eipsi-forms"),value:parseFloat(l.spacing.sectionGap),onChange:e=>c("spacing","sectionGap",`${e}rem`),min:1,max:5,step:.25,help:(0,r.__)("Spacing between major form sections","eipsi-forms")}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Spacing Scale","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Extra Small","eipsi-forms"),value:parseFloat(l.spacing.xs),onChange:e=>c("spacing","xs",`${e}rem`),min:.25,max:2,step:.25}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Small","eipsi-forms"),value:parseFloat(l.spacing.sm),onChange:e=>c("spacing","sm",`${e}rem`),min:.5,max:3,step:.25}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Medium","eipsi-forms"),value:parseFloat(l.spacing.md),onChange:e=>c("spacing","md",`${e}rem`),min:1,max:4,step:.25}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Large","eipsi-forms"),value:parseFloat(l.spacing.lg),onChange:e=>c("spacing","lg",`${e}rem`),min:1.5,max:5,step:.25}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Extra Large","eipsi-forms"),value:parseFloat(l.spacing.xl),onChange:e=>c("spacing","xl",`${e}rem`),min:2,max:6,step:.25})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üî≤ Borders & Radius","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Configure border styles and corner radius for clinical aesthetics.","eipsi-forms")}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Border Radius","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Small Radius","eipsi-forms"),value:parseInt(l.borders.radiusSm),onChange:e=>c("borders","radiusSm",`${e}px`),min:0,max:20,step:1,help:(0,r.__)("Used for small elements","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Medium Radius","eipsi-forms"),value:parseInt(l.borders.radiusMd),onChange:e=>c("borders","radiusMd",`${e}px`),min:0,max:30,step:1,help:(0,r.__)("Used for inputs and buttons","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Large Radius","eipsi-forms"),value:parseInt(l.borders.radiusLg),onChange:e=>c("borders","radiusLg",`${e}px`),min:0,max:40,step:1,help:(0,r.__)("Used for containers and sections","eipsi-forms")}),(0,m.jsx)("h4",{className:"eipsi-section-title",children:(0,r.__)("Border Width & Style","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Border Width","eipsi-forms"),value:parseInt(l.borders.width),onChange:e=>c("borders","width",`${e}px`),min:0,max:10,step:1}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Focus Border Width","eipsi-forms"),value:parseInt(l.borders.widthFocus),onChange:e=>c("borders","widthFocus",`${e}px`),min:0,max:10,step:1,help:(0,r.__)("Thicker border for focused elements","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Border Style","eipsi-forms"),value:l.borders.style,options:[{label:"Solid",value:"solid"},{label:"Dashed",value:"dashed"},{label:"Dotted",value:"dotted"},{label:"None",value:"none"}],onChange:e=>c("borders","style",e)})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("‚ú® Shadows & Effects","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Add depth and visual feedback with shadows.","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Small Shadow","eipsi-forms"),value:l.shadows.sm,onChange:e=>c("shadows","sm",e),help:(0,r.__)("Subtle elevation for small elements","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Medium Shadow","eipsi-forms"),value:l.shadows.md,onChange:e=>c("shadows","md",e),help:(0,r.__)("Standard card depth","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Large Shadow","eipsi-forms"),value:l.shadows.lg,onChange:e=>c("shadows","lg",e),help:(0,r.__)("Prominent elevation","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Focus Shadow","eipsi-forms"),value:l.shadows.focus,onChange:e=>c("shadows","focus",e),help:(0,r.__)("Ring effect for focused elements","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("‚ö° Hover & Interaction","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{className:"eipsi-panel-description",children:(0,r.__)("Configure animation and interaction feedback.","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Transition Duration","eipsi-forms"),value:l.interactivity.transitionDuration,onChange:e=>c("interactivity","transitionDuration",e),help:(0,r.__)("E.g., 0.2s or 200ms","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Transition Timing","eipsi-forms"),value:l.interactivity.transitionTiming,options:[{label:"Linear",value:"linear"},{label:"Ease",value:"ease"},{label:"Ease In",value:"ease-in"},{label:"Ease Out",value:"ease-out"},{label:"Ease In Out",value:"ease-in-out"}],onChange:e=>c("interactivity","transitionTiming",e)}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Hover Scale","eipsi-forms"),value:l.interactivity.hoverScale,onChange:e=>c("interactivity","hoverScale",e),help:(0,r.__)("E.g., 1.02 for slight growth on hover","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Focus Outline Width","eipsi-forms"),value:parseInt(l.interactivity.focusOutlineWidth),onChange:e=>c("interactivity","focusOutlineWidth",`${e}px`),min:0,max:10,step:1,help:(0,r.__)("Recommended: 2‚Äì3px for accessibility","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Focus Outline Offset","eipsi-forms"),value:parseInt(l.interactivity.focusOutlineOffset),onChange:e=>c("interactivity","focusOutlineOffset",`${e}px`),min:0,max:10,step:1})]})]})},v=({isOpen:e,onClose:i,containerClientId:s})=>{const{mapData:o}=(0,n.useSelect)(e=>{if(!s)return{mapData:[]};const{getBlock:i}=e("core/block-editor"),o=i(s);return o&&o.innerBlocks?{mapData:o.innerBlocks.filter(e=>"eipsi/form-page"===e.name).map((e,i)=>{const s=i+1,o=e.attributes.title||`${(0,r.__)("P√°gina","eipsi-forms")} ${s}`,a=[],t=e=>{e.forEach(e=>{const{attributes:i,name:s}=e;if(i.conditionalLogic){const o=(e=>e?Array.isArray(e)?{enabled:e.length>0,rules:e,defaultAction:"nextPage"}:"object"==typeof e&&void 0!==e.enabled?e:null:null)(i.conditionalLogic);o&&o.enabled&&o.rules.length>0&&a.push({blockName:s,label:i.label||i.fieldName||(0,r.__)("Campo sin nombre","eipsi-forms"),logic:o,clientId:e.clientId})}e.innerBlocks&&e.innerBlocks.length>0&&t(e.innerBlocks)})};return t(e.innerBlocks||[]),{pageNumber:s,pageTitle:o,fields:a}}).filter(e=>e.fields.length>0)}:{mapData:[]}},[s]);if(!e)return null;const a=e=>{if(e.conditions&&Array.isArray(e.conditions)){const i=[];return e.conditions.forEach((e,s)=>{let o="";const a=e.fieldLabel||e.fieldId||(0,r.__)("Campo","eipsi-forms");if(o="numeric"===e.fieldType&&e.operator&&void 0!==e.threshold?`[${a}] ${"=="===e.operator?"=":e.operator} ${e.threshold}`:void 0!==e.value?`[${a}] = "${e.value}"`:`[${a}]`,s>0){const s="OR"===(e.logicalOperator||"AND")?(0,r.__)("O","eipsi-forms"):(0,r.__)("Y","eipsi-forms");i.push(` ${s} `)}i.push(o)}),i.join("")}return e.operator&&void 0!==e.threshold?`${"=="===e.operator?"=":e.operator} ${e.threshold}`:void 0!==e.matchValue?`= "${e.matchValue}"`:(0,r.__)("Condici√≥n no definida","eipsi-forms")},l=e=>{switch(e.action){case"nextPage":return(0,r.__)("Siguiente p√°gina","eipsi-forms");case"submit":return(0,r.__)("Finalizar formulario","eipsi-forms");case"goToPage":return`${(0,r.__)("Ir a p√°gina","eipsi-forms")} ${e.targetPage}`;default:return(0,r.__)("Acci√≥n desconocida","eipsi-forms")}};return e?(0,m.jsxs)(t.Modal,{title:(0,r.__)("Mapa de l√≥gica condicional","eipsi-forms"),onRequestClose:i,className:"conditional-logic-map-modal",style:{maxWidth:"800px",width:"90vw"},children:[(0,m.jsx)("div",{className:"conditional-logic-map-content",children:0===o.length?(0,m.jsx)("div",{className:"conditional-logic-map-empty",children:(0,m.jsx)("p",{children:(0,r.__)("No hay reglas de l√≥gica condicional configuradas en este formulario.","eipsi-forms")})}):o.map(e=>(0,m.jsxs)("div",{className:"logic-map-page",children:[(0,m.jsx)("h3",{className:"logic-map-page-title",children:e.pageTitle}),e.fields.map((e,i)=>(0,m.jsxs)("div",{className:"logic-map-field",children:[(0,m.jsx)("h4",{className:"logic-map-field-label",children:e.label}),(0,m.jsx)("ul",{className:"logic-map-rules",children:e.logic.rules.map((e,i)=>{const s=(e=>{if(!e.conditions||e.conditions.length<2)return null;const i=e.conditions.map((e,i)=>0===i?null:e.logicalOperator||"AND").filter(Boolean),s=i.some(e=>"OR"===e),o=i.some(e=>"OR"!==e);return s&&o?{label:(0,r.__)("AND/OR combinados","eipsi-forms"),type:"mixed"}:s?{label:(0,r.__)("O","eipsi-forms"),type:"or"}:{label:(0,r.__)("Y","eipsi-forms"),type:"and"}})(e);return(0,m.jsxs)("li",{className:"logic-map-rule",children:[(0,m.jsxs)("span",{className:"logic-map-rule-condition",children:[(0,m.jsx)("strong",{children:(0,r.__)("SI","eipsi-forms")})," ",a(e)]}),s&&(0,m.jsx)("span",{className:`logic-map-operator-badge logic-map-operator-badge--${s.type}`,children:s.label}),(0,m.jsx)("span",{className:"logic-map-rule-arrow",children:"‚Üí"})," ",(0,m.jsx)("span",{className:"logic-map-rule-action",children:l(e)})]},i)})}),e.logic.defaultAction&&"nextPage"!==e.logic.defaultAction&&(0,m.jsxs)("div",{className:"logic-map-default-action",children:[(0,m.jsx)("span",{className:"logic-map-rule-condition",children:(0,m.jsx)("strong",{children:(0,r.__)("Para otros valores","eipsi-forms")})})," ",(0,m.jsx)("span",{className:"logic-map-rule-arrow",children:"‚Üí"})," ",(0,m.jsx)("span",{className:"logic-map-rule-action",children:l({action:e.logic.defaultAction,targetPage:e.logic.defaultTargetPage})})]})]},i))]},e.pageNumber))}),(0,m.jsx)("div",{className:"conditional-logic-map-footer",children:(0,m.jsx)(t.Button,{isPrimary:!0,onClick:i,children:(0,r.__)("Cerrar","eipsi-forms")})})]}):null};function j({pages:e,totalTime:i,showTimingAnalysis:s}){return s&&e&&0!==e.length?(0,m.jsxs)("div",{className:"timing-analysis-panel",children:[(0,m.jsxs)("div",{className:"timing-summary",children:[(0,m.jsx)("h4",{children:(0,r.__)("‚è±Ô∏è Tiempos por P√°gina","eipsi-forms")}),(0,m.jsxs)("p",{className:"timing-total",children:[(0,r.__)("‚è∞ Tiempo total:","eipsi-forms")," ",i," ","sec"]})]}),(0,m.jsxs)("table",{className:"timing-table",children:[(0,m.jsx)("thead",{children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:(0,r.__)("P√°gina","eipsi-forms")}),(0,m.jsx)("th",{children:(0,r.__)("Duraci√≥n","eipsi-forms")}),(0,m.jsx)("th",{children:(0,r.__)("Timestamp","eipsi-forms")})]})}),(0,m.jsx)("tbody",{children:e.map((e,i)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{children:e.name}),(0,m.jsx)("td",{children:e.duration}),(0,m.jsx)("td",{children:e.timestamp})]},i))})]})]}):null}const C={enabled:!1,method:"seeded",forms:[],probabilities:{},manualAssigns:[]};(0,o.registerBlockType)("eipsi/form-container",{attributes:{formId:{type:"string",default:""},submitButtonLabel:{type:"string",default:"Enviar"},description:{type:"string",default:""},styleConfig:{type:"object",default:JSON.parse(JSON.stringify(u))},presetName:{type:"string",default:"Clinical Blue"},allowBackwardsNav:{type:"boolean",default:!0},showProgressBar:{type:"boolean",default:!0},studyStatus:{type:"string",default:"open"},useCustomCompletion:{type:"boolean",default:!1},completionTitle:{type:"string",default:""},completionMessage:{type:"string",default:""},completionLogoId:{type:"number",default:0},completionLogoUrl:{type:"string",default:""},completionButtonLabel:{type:"string",default:""},useRandomization:{type:"boolean",default:!1},randomConfig:{type:"object",default:{forms:[],probabilities:{},method:"seeded",manualAssigns:[]}},capturePageTiming:{type:"boolean",default:!0},captureFieldTiming:{type:"boolean",default:!0},showTimingAnalysis:{type:"boolean",default:!1}},edit:function({attributes:e,setAttributes:i,clientId:s,className:l}){const{formId:c,submitButtonLabel:d,description:u,styleConfig:g,presetName:x,allowBackwardsNav:b,showProgressBar:_,studyStatus:w,useCustomCompletion:S,completionTitle:N,completionMessage:k,completionLogoId:I,completionLogoUrl:B,completionButtonLabel:T,useRandomization:P,randomConfig:F,capturePageTiming:A,captureFieldTiming:$,showTimingAnalysis:E}=e,z=F&&"object"==typeof F?{...C,...F,forms:Array.isArray(F.forms)?F.forms:[],probabilities:F.probabilities&&"object"==typeof F.probabilities?F.probabilities:{},manualAssigns:Array.isArray(F.manualAssigns)?F.manualAssigns:[]}:{...C},R="boolean"!=typeof b||b,O="boolean"!=typeof _||_,q="closed"==("closed"===w?"closed":"open"),L="boolean"==typeof S&&S,[M,D]=(0,p.useState)(!1),[V,H]=(0,p.useState)(""),[U,W]=(0,p.useState)(!1),{replaceInnerBlocks:G}=(0,n.useDispatch)(a.store),[J,Z]=(0,p.useState)([]),[K,Y]=(0,p.useState)(!1),[X,Q]=(0,p.useState)(!1),[ee,ie]=(0,p.useState)(""),[se,oe]=(0,p.useState)("");(0,p.useEffect)(()=>{P&&0===J.length&&ae()},[P,J.length]);const ae=async()=>{Y(!0);try{const e=window?.eipsiEditorData?.ajaxurl||"/wp-admin/admin-ajax.php",i=window?.eipsiEditorData?.nonce||window?.eipsiAdminNonce||"",s=await fetch(e+"?action=eipsi_get_forms_list&nonce="+encodeURIComponent(i),{credentials:"same-origin"});if(!s.ok)throw new Error(`HTTP ${s.status}`);const o=await s.json();o?.success&&Z(Array.isArray(o.data)?o.data:[])}catch(e){console.error("Error cargando formularios:",e)}Y(!1)},te=(e,s)=>{const o={...z,[e]:s};i({randomConfig:o})},re=e=>{const i=J.find(i=>i.id===parseInt(e));return i?i.name||i.label:`Formulario ${e}`},ne=Object.values(z.probabilities||{}).reduce((e,i)=>e+(parseInt(i)||0),0),le=J.filter(e=>!z.forms.includes(e.id));(0,p.useEffect)(()=>{const s={};if(g||(s.styleConfig=f(e)),x||(s.presetName="Clinical Blue"),"boolean"!=typeof S){const e=N&&"¬°Gracias por completar el cuestionario!"!==N||k&&"Sus respuestas han sido registradas correctamente."!==k||T&&"Comenzar de nuevo"!==T||!!B;s.useCustomCompletion=e}Object.keys(s).length&&i(s)},[]);const ce=g||f(e),de=h(ce),pe=(0,a.useBlockProps)({className:"eipsi-form eipsi-form "+(l||""),style:de,"data-preset":x||"Clinical Blue"}),me=(0,a.useInnerBlocksProps)({className:"eipsi-form eipsi-form-content"},{allowedBlocks:["eipsi/form-page","eipsi/consent-block","eipsi/campo-texto","eipsi/campo-textarea","eipsi/campo-descripcion","eipsi/campo-select","eipsi/campo-radio","eipsi/campo-multiple","eipsi/campo-likert","eipsi/vas-slider"],templateLock:!1,renderAppender:a.InnerBlocks.ButtonBlockAppender}),ue=(0,n.useSelect)(e=>e(a.store).getBlocks(s),[s]),fe=ue&&ue.length>0,he=window?.EIPSIDemoTemplates||{},ge=he.templates||[],xe=he.strings||{},[be,_e]=(0,p.useState)(null),ye=[{label:xe.selectPlaceholder||(0,r.__)("Eleg√≠ una plantilla","eipsi-forms"),value:""},...ge.map(e=>({label:`${e.icon||""} ${e.name}`.trim(),value:e.id}))],ve=ge.find(e=>e.id===V);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Plantillas EIPSI","eipsi-forms"),initialOpen:!1,children:[be&&(0,m.jsx)(t.Notice,{status:be.status,onRemove:()=>_e(null),isDismissible:!0,style:{marginBottom:"16px"},children:be.message}),0===ge.length&&(0,m.jsx)(t.Notice,{status:"info",isDismissible:!1,children:xe.empty||(0,r.__)("Pr√≥ximamente agregaremos m√°s demos pensados para tu consultorio.","eipsi-forms")}),ge.length>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{style:{fontSize:"13px",color:"#475467",marginBottom:"12px"},children:(0,r.__)("Estas plantillas son demos gen√©ricos con bloques EIPSI reales. No son escalas cl√≠nicas oficiales.","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:xe.selectLabel||(0,r.__)("Plantillas EIPSI (demo)","eipsi-forms"),value:V,options:ye,onChange:e=>H(e)}),ve&&(0,m.jsx)("div",{style:{marginTop:"8px",padding:"8px",background:"#f8f9fb",borderRadius:"4px",fontSize:"12px",color:"#646970"},children:ve.description}),V&&(0,m.jsx)(t.Button,{variant:"primary",onClick:()=>{if(!V)return;if(fe&&!window.confirm(xe.confirmReplace||(0,r.__)("Esto reemplazar√° el contenido actual del formulario. ¬øContinuar?","eipsi-forms")))return;W(!0),_e(null);const e=ve;if(!e||!e.content)return W(!1),void _e({status:"error",message:(0,r.__)("No pudimos cargar la plantilla seleccionada.","eipsi-forms")});try{const a=(0,o.parse)(e.content);if(!a||0===a.length||"eipsi/form-container"!==a[0].name)throw new Error("Invalid template structure");const t=a[0],n=t.innerBlocks||[],l=t.attributes||{},c={};["formId","submitButtonLabel","description","presetName","allowBackwardsNav","showProgressBar","studyStatus","useCustomCompletion","completionTitle","completionMessage","completionButtonLabel","styleConfig"].forEach(e=>{Object.prototype.hasOwnProperty.call(l,e)&&(c[e]=l[e])}),Object.keys(c).length>0&&i(c),G(s,n,!1),H(""),_e({status:"success",message:xe.success||(0,r.__)("Plantilla aplicada correctamente.","eipsi-forms")})}catch(e){console.error("Error applying template:",e),_e({status:"error",message:(0,r.__)("No pudimos aplicar la plantilla. Intent√° nuevamente.","eipsi-forms")})}finally{W(!1)}},isBusy:U,disabled:U,style:{marginTop:"12px",width:"100%"},children:xe.apply||(0,r.__)("Aplicar plantilla","eipsi-forms")})]})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Form Settings","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("Form ID/Slug","eipsi-forms"),value:c,onChange:e=>i({formId:e}),help:(0,r.__)("Enter a unique identifier for the form (e.g., contact-form)","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Submit Button Label","eipsi-forms"),value:d,onChange:e=>i({submitButtonLabel:e})}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Description (Optional)","eipsi-forms"),value:u,onChange:e=>i({description:e}),help:(0,r.__)("Optional description text shown above the form","eipsi-forms")}),(0,m.jsx)(t.Notice,{status:q?"warning":"success",isDismissible:!1,style:{marginTop:"12px"},children:q?(0,r.__)("üî¥ Cerrado: este estudio no acepta nuevas respuestas.","eipsi-forms"):(0,r.__)("üü¢ Abierto: este estudio acepta respuestas normalmente.","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Estado del estudio","eipsi-forms"),checked:q,onChange:e=>i({studyStatus:e?"closed":"open"}),help:q?(0,r.__)("Para volver a recolectar datos, cambialo a Abierto.","eipsi-forms"):(0,r.__)("Si lo cerr√°s, el formulario se oculta y muestra un aviso en el frontend.","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Navigation Settings","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)(t.ToggleControl,{label:(0,r.__)('Mostrar bot√≥n "Anterior"',"eipsi-forms"),checked:R,onChange:e=>i({allowBackwardsNav:!!e}),help:(0,r.__)('Permite al paciente volver a la p√°gina anterior. Si est√° desactivado, el bot√≥n "Anterior" no aparecer√° nunca.',"eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Mostrar barra de progreso","eipsi-forms"),checked:O,onChange:e=>i({showProgressBar:!!e}),help:(0,r.__)('Muestra "P√°gina X de Y" en la parte inferior del formulario. √ötil en formularios con m√∫ltiples p√°ginas.',"eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Completion Page","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Personalizar p√°gina de finalizaci√≥n","eipsi-forms"),checked:L,onChange:e=>i({useCustomCompletion:!!e}),help:(0,r.__)("Si est√° desactivado, se usar√° la configuraci√≥n global de Finalizaci√≥n (Results & Experience ‚Üí Finalizaci√≥n). Si est√° activado, podr√°s personalizar el mensaje de finalizaci√≥n solo para este formulario.","eipsi-forms")}),!L&&(0,m.jsx)("p",{style:{marginTop:"12px",fontSize:"13px",color:"#475467",background:"#f8f9fb",padding:"12px",borderRadius:"6px"},children:(0,r.__)("Este formulario usar√° el mensaje global configurado en Results & Experience ‚Üí Finalizaci√≥n.","eipsi-forms")}),L&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("T√≠tulo de finalizaci√≥n","eipsi-forms"),value:N,onChange:e=>i({completionTitle:e}),help:(0,r.__)("T√≠tulo que se muestra al completar el formulario","eipsi-forms")}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Mensaje de finalizaci√≥n","eipsi-forms"),value:k,onChange:e=>i({completionMessage:e}),help:(0,r.__)("Mensaje que se muestra al completar el formulario","eipsi-forms"),rows:4}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Texto del bot√≥n","eipsi-forms"),value:T,onChange:e=>i({completionButtonLabel:e}),help:(0,r.__)('Por ejemplo: "Comenzar de nuevo" o "Volver a empezar"',"eipsi-forms")}),(0,m.jsx)(a.MediaUploadCheck,{children:(0,m.jsxs)("div",{style:{marginTop:"16px"},children:[(0,m.jsx)("p",{style:{marginBottom:"8px",fontWeight:"500"},children:(0,r.__)("Logo o imagen (opcional)","eipsi-forms")}),B&&(0,m.jsx)("div",{style:{marginBottom:"12px"},children:(0,m.jsx)("img",{src:B,alt:(0,r.__)("Logo del consultorio","eipsi-forms"),style:{maxWidth:"200px",height:"auto",borderRadius:"8px"}})}),(0,m.jsx)(a.MediaUpload,{onSelect:e=>i({completionLogoId:e.id,completionLogoUrl:e.url}),allowedTypes:["image"],value:I,render:({open:e})=>(0,m.jsxs)("div",{children:[(0,m.jsx)(t.Button,{variant:"secondary",onClick:e,children:B?(0,r.__)("Cambiar imagen","eipsi-forms"):(0,r.__)("Seleccionar imagen","eipsi-forms")}),B&&(0,m.jsx)(t.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>i({completionLogoId:0,completionLogoUrl:""}),style:{marginLeft:"8px"},children:(0,r.__)("Quitar","eipsi-forms")})]})}),(0,m.jsx)("p",{style:{fontSize:"12px",color:"#757575",marginTop:"8px"},children:(0,r.__)("Se mostrar√° en la parte superior de la p√°gina de finalizaci√≥n","eipsi-forms")})]})})]})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Mapa de l√≥gica condicional","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("p",{style:{fontSize:"13px",color:"#475467",marginBottom:"12px"},children:(0,r.__)("Visualiz√° todas las reglas del formulario agrupadas por p√°gina. Solo lectura para revisar y explicar flujos cl√≠nicos.","eipsi-forms")}),(0,m.jsx)(t.Button,{variant:"secondary",onClick:()=>D(!0),children:(0,r.__)("Ver mapa de condiciones","eipsi-forms")})]}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Apariencia del formulario","eipsi-forms"),initialOpen:!1,children:(0,m.jsx)(y,{styleConfig:ce,setStyleConfig:e=>{i({styleConfig:e})},presetName:x||"Clinical Blue",setPresetName:e=>i({presetName:e})})}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Analytics & Timing","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Capturar tiempos por p√°gina","eipsi-forms"),checked:A,onChange:e=>i({capturePageTiming:e})}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Capturar tiempos por campo","eipsi-forms"),checked:$,onChange:e=>i({captureFieldTiming:e})}),(0,m.jsx)("hr",{}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("‚è±Ô∏è Hide Timing Analysis","eipsi-forms"),checked:!E,onChange:e=>i({showTimingAnalysis:!e}),help:(0,r.__)("Muestra u oculta la tabla de an√°lisis de tiempos en esta vista previa.","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üé≤ Aleatorizaci√≥n","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Activar aleatorizaci√≥n de asignaci√≥n","eipsi-forms"),checked:!!P,onChange:e=>i({useRandomization:!!e}),help:(0,r.__)("Asigna formularios aleatoriamente a los participantes seg√∫n las probabilidades configuradas.","eipsi-forms")}),P&&(0,m.jsxs)("div",{className:"eipsi-randomization-panel",children:[(0,m.jsxs)(t.BaseControl,{id:"eipsi-random-forms-select",label:(0,r.__)("Formularios para aleatorizar","eipsi-forms"),children:[(0,m.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[(0,m.jsx)(t.SelectControl,{value:"",options:[{label:(0,r.__)("Seleccionar formulario‚Ä¶","eipsi-forms"),value:""},...le.map(e=>({label:e.name||e.label,value:String(e.id)}))],onChange:s=>{s&&(s=>{const o=e.randomConfig&&"object"==typeof e.randomConfig?{...C,...e.randomConfig,forms:Array.isArray(e.randomConfig.forms)?e.randomConfig.forms:[]}:{...C};if(!s||o.forms.includes(parseInt(s)))return;const a=[...o.forms,parseInt(s)],t={...o.probabilities},r=Math.floor(100/a.length);a.forEach((e,i)=>{t[e]=i===a.length-1?100-r*(a.length-1):r}),i({randomConfig:{...o,forms:a,probabilities:t}})})(s)},disabled:0===le.length}),(0,m.jsx)(t.Button,{variant:"secondary",onClick:ae,isBusy:K,children:"üîÑ"})]}),0===J.length&&!K&&(0,m.jsx)(t.Notice,{status:"info",isDismissible:!1,style:{marginBottom:"12px"},children:(0,r.__)("No hay formularios disponibles en la Form Library. Cre√° al menos 2 formularios para usar la aleatorizaci√≥n.","eipsi-forms")}),z.forms.length<2&&J.length>0&&(0,m.jsx)(t.Notice,{status:"warning",isDismissible:!1,style:{marginBottom:"12px"},children:(0,r.__)("A√±ad√≠ al menos 2 formularios para activar la aleatorizaci√≥n.","eipsi-forms")}),z.forms.length>0&&(0,m.jsxs)("div",{className:"eipsi-forms-list",children:[z.forms.map(s=>(0,m.jsxs)("div",{className:"eipsi-form-row",style:{marginBottom:"16px",padding:"12px",background:"#fff",borderRadius:"6px",border:"1px solid #e2e8f0"},children:[(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,m.jsx)("strong",{children:re(s)}),(0,m.jsx)(t.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>(s=>{const o=e.randomConfig&&"object"==typeof e.randomConfig?{...C,...e.randomConfig,forms:Array.isArray(e.randomConfig.forms)?e.randomConfig.forms:[]}:{...C},a=o.forms.filter(e=>e!==s),t={...o.probabilities};if(delete t[s],a.length>0){const e=Math.floor(100/a.length);a.forEach((i,s)=>{t[i]=s===a.length-1?100-e*(a.length-1):e})}i({randomConfig:{...o,forms:a,probabilities:t}})})(s),icon:"no-alt"})]}),(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,m.jsx)("input",{type:"range",min:"0",max:"100",value:z.probabilities[s]||0,onChange:o=>((s,o)=>{const a=e.randomConfig&&"object"==typeof e.randomConfig?{...C,...e.randomConfig,forms:Array.isArray(e.randomConfig.forms)?e.randomConfig.forms:[],probabilities:e.randomConfig.probabilities&&"object"==typeof e.randomConfig.probabilities?e.randomConfig.probabilities:{}}:{...C},t=parseInt(o),r={...a.probabilities};r[s]=t;const n=a.forms.filter(e=>e!==s);if(n.length>0){const e=100-t;if(n.reduce((e,i)=>e+(r[i]||0),0)>0){const i=e/n.length;n.forEach((s,o)=>{r[s]=o===n.length-1?e-i*(n.length-1):i})}else{const i=e/n.length;n.forEach((s,o)=>{r[s]=o===n.length-1?e-i*(n.length-1):i})}}i({randomConfig:{...a,probabilities:r}})})(s,o.target.value),style:{flex:1}}),(0,m.jsxs)("span",{style:{minWidth:"50px",textAlign:"right",fontWeight:600,color:100!==ne?"#d32f2f":"#198754"},children:[z.probabilities[s]||0,"%"]})]})]},s)),(0,m.jsxs)("div",{style:{textAlign:"center",padding:"8px",background:100===ne?"#dcfce7":"#fef3c7",borderRadius:"6px",fontWeight:600,color:100===ne?"#166534":"#92400e"},children:[(0,r.__)("Total:","eipsi-forms")," ",ne,"%"]})]})]}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("M√©todo de aleatorizaci√≥n","eipsi-forms"),value:z.method||"seeded",options:[{label:(0,r.__)("Simple (uniforme)","eipsi-forms"),value:"simple"},{label:(0,r.__)("Con seed reproducible","eipsi-forms"),value:"seeded"}],onChange:e=>te("method",e),help:(0,r.__)("Simple: random puro. Seed: asigna UUID √∫nico para replicar en an√°lisis.","eipsi-forms")}),(0,m.jsxs)(t.BaseControl,{id:"eipsi-random-manual-assigns",label:(0,r.__)("Asignaciones manuales (override √©tico)","eipsi-forms"),help:(0,r.__)("Estas asignaciones tienen prioridad sobre la aleatorizaci√≥n autom√°tica.","eipsi-forms"),children:[(0,m.jsxs)("div",{style:{display:"grid",gap:"8px",marginBottom:"12px"},children:[(0,m.jsx)(t.TextControl,{placeholder:(0,r.__)("Email del participante","eipsi-forms"),value:ee,onChange:ie,type:"email"}),(0,m.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,m.jsx)(t.SelectControl,{value:se,options:[{label:(0,r.__)("Seleccionar formulario‚Ä¶","eipsi-forms"),value:""},...J.map(e=>({label:e.name,value:String(e.id)}))],onChange:oe,style:{flex:1}}),(0,m.jsx)(t.Button,{variant:"primary",onClick:()=>{if(!ee||!se)return;const e=[...z.manualAssigns,{email:ee.toLowerCase().trim(),formId:parseInt(se),timestamp:(new Date).toISOString()}];te("manualAssigns",e),ie(""),oe("")},disabled:!ee||!se,children:(0,r.__)("A√±adir","eipsi-forms")})]})]}),z.manualAssigns.length>0&&(0,m.jsxs)("table",{className:"eipsi-manual-assigns-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[(0,m.jsx)("thead",{children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{style:{padding:"8px",background:"#f1f5f9",textAlign:"left"},children:(0,r.__)("Email","eipsi-forms")}),(0,m.jsx)("th",{style:{padding:"8px",background:"#f1f5f9",textAlign:"left"},children:(0,r.__)("Formulario","eipsi-forms")}),(0,m.jsx)("th",{style:{padding:"8px",background:"#f1f5f9",width:"40px"}})]})}),(0,m.jsx)("tbody",{children:z.manualAssigns.map((e,i)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{style:{padding:"8px"},children:e.email}),(0,m.jsx)("td",{style:{padding:"8px"},children:re(e.formId)}),(0,m.jsx)("td",{style:{padding:"8px"},children:(0,m.jsx)(t.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>(e=>{const i=z.manualAssigns.filter((i,s)=>s!==e);te("manualAssigns",i)})(i),icon:"no-alt"})})]},i))})]})]}),(0,m.jsx)(t.Button,{variant:"secondary",onClick:async()=>{const i=e.randomConfig&&"object"==typeof e.randomConfig?{...C,...e.randomConfig,forms:Array.isArray(e.randomConfig.forms)?e.randomConfig.forms:[]}:{...C};if(!i.enabled||i.forms.length<2)window.alert((0,r.__)("Necesit√°s configurar al menos 2 formularios para generar el link de aleatorizaci√≥n.","eipsi-forms"));else try{const e=window?.eipsiEditorData?.ajaxurl||"/wp-admin/admin-ajax.php",i=window?.eipsiEditorData?.nonce||window?.eipsiAdminNonce||"",s=await fetch(`${e}?action=eipsi_get_randomization_pages&nonce=${encodeURIComponent(i)}`,{credentials:"same-origin"}),o=await s.json();if(o.success&&o.data.length>0){const e=`${o.data[0].link}?eipsi_random=true&study_id=${c}`;navigator.clipboard.writeText(e).then(()=>{Q(!0),setTimeout(()=>Q(!1),2e3)}),window.alert(`${(0,r.__)("Link generado:","eipsi-forms")}\n${e}`)}else{const e=`${window.location.href.split("?")[0]}?eipsi_random=true&study_id=${c}`;navigator.clipboard.writeText(e).then(()=>{Q(!0),setTimeout(()=>Q(!1),2e3)}),window.alert(`${(0,r.__)("Link generado (p√°gina actual):","eipsi-forms")}\n${e}\n\n${(0,r.__)("‚ö†Ô∏è Recomendaci√≥n: cre√° una p√°gina con el shortcode [eipsi_randomized_form] para un mejor funcionamiento.","eipsi-forms")}`)}}catch(e){const i=`${window.location.href.split("?")[0]}?eipsi_random=true&study_id=${c}`;navigator.clipboard.writeText(i).then(()=>{Q(!0),setTimeout(()=>Q(!1),2e3)}),window.alert(`${(0,r.__)("Link generado (fallback):","eipsi-forms")}\n${i}`)}},style:{width:"100%",marginTop:"16px"},children:X?"‚úì "+(0,r.__)("Link copiado","eipsi-forms"):"üîó "+(0,r.__)("Generar link con random","eipsi-forms")}),z.forms.length>=2&&(0,m.jsxs)("div",{className:"eipsi-random-preview",style:{marginTop:"16px",padding:"12px",background:"#f8f9fb",borderRadius:"6px",fontSize:"12px"},children:[(0,m.jsx)("strong",{children:(0,r.__)("Vista previa:","eipsi-forms")}),(0,m.jsx)("br",{}),(0,r.__)("Aleatorizaci√≥n activa:","eipsi-forms")," ",z.forms.map(e=>`${re(e)} (${z.probabilities[e]||0}%)`).join(" | "),(0,m.jsx)("br",{}),(0,r.__)("M√©todo:","eipsi-forms")," ","seeded"===z.method?(0,r.__)("Con seed reproducible","eipsi-forms"):(0,r.__)("Simple (uniforme)","eipsi-forms"),(0,m.jsx)("br",{}),(0,r.__)("Overrides manuales:","eipsi-forms")," ",z.manualAssigns.length]})]})]})]}),M&&(0,m.jsx)(v,{isOpen:M,onClose:()=>D(!1),containerClientId:s}),(0,m.jsxs)("div",{...pe,children:[(0,m.jsxs)("div",{className:"eipsi-form-container-preview",children:[!c&&(0,m.jsx)("div",{className:"eipsi-form-placeholder",children:(0,m.jsxs)("div",{className:"components-placeholder",children:[(0,m.jsx)("div",{className:"components-placeholder__label",children:(0,r.__)("EIPSI Form Container","eipsi-forms")}),(0,m.jsx)("div",{className:"components-placeholder__instructions",children:(0,r.__)("Please enter a Form ID in the block settings to get started.","eipsi-forms")})]})}),c&&(0,m.jsxs)("div",{className:"eipsi-form-preview-wrapper",children:[(0,m.jsxs)("div",{className:"form-header",children:[(0,m.jsx)("h3",{className:"form-title",children:c.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),(0,m.jsx)("div",{className:"eipsi-study-status-indicator",style:{marginTop:"6px",fontSize:"12px",fontWeight:600,color:q?"var(--eipsi-color-error, #d32f2f)":"var(--eipsi-color-success, #198754)"},children:q?`üî¥ ${(0,r.__)("Cerrado","eipsi-forms")}`:`üü¢ ${(0,r.__)("Abierto","eipsi-forms")}`}),u&&(0,m.jsx)("p",{className:"form-description",children:u})]}),(0,m.jsx)("div",{...me}),(0,m.jsx)("div",{className:"form-footer",children:(0,m.jsx)("button",{type:"button",className:"eipsi-submit-button",disabled:!0,children:d||(0,r.__)("Submit","eipsi-forms")})})]})]}),(0,m.jsx)(j,{showTimingAnalysis:E,totalTime:"12.5",pages:[{name:"P√°gina 1",duration:"5.2 s",timestamp:"14:20:05"},{name:"P√°gina 2",duration:"7.3 s",timestamp:"14:20:12"}]})]})]})},save:function({attributes:e}){const{formId:i,submitButtonLabel:s,description:o,className:t,styleConfig:n,presetName:l,allowBackwardsNav:c,showProgressBar:d,studyStatus:p,useCustomCompletion:u,completionTitle:g,completionMessage:x,completionLogoUrl:b,completionButtonLabel:_,capturePageTiming:y,captureFieldTiming:v}=e,j="boolean"!=typeof c||c,C="boolean"!=typeof d||d,w="closed"===p?"closed":"open",S="boolean"==typeof u&&u,N=h(n||f(e)),k=S?{"data-completion-title":g||"¬°Gracias por completar el cuestionario!","data-completion-message":x||"Sus respuestas han sido registradas correctamente.","data-completion-logo":b||"","data-completion-button-label":_||"Comenzar de nuevo"}:{},I=a.useBlockProps.save({className:"eipsi-form eipsi-form "+(t||""),style:N,"data-preset":l||"Clinical Blue","data-study-status":w,...k}),B=a.useInnerBlocksProps.save({className:"eipsi-form eipsi-form-content"});return(0,m.jsxs)("div",{...I,children:["closed"===w&&(0,m.jsx)("div",{className:"eipsi-study-closed-notice",role:"alert",children:(0,r.__)("Este estudio est√° cerrado y no acepta m√°s respuestas. Contacta al investigador si tienes dudas.","eipsi-forms")}),o&&(0,m.jsx)("header",{className:"eipsi-header",children:(0,m.jsx)("h2",{children:o})}),(0,m.jsxs)("form",{className:"vas-form eipsi-form-element","data-form-id":i,"data-allow-backwards-nav":j?"true":"false","data-show-progress-bar":C?"true":"false","data-capture-page-timing":y?"true":"false","data-capture-field-timing":v?"true":"false",children:[(0,m.jsx)("input",{type:"hidden",name:"form_id",value:i}),(0,m.jsx)("input",{type:"hidden",name:"form_action",value:"eipsi_forms_submit_form"}),(0,m.jsx)("input",{type:"hidden",name:"eipsi_nonce",value:""}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-device-placeholder",name:"device"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-browser-placeholder",name:"browser"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-os-placeholder",name:"os"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-screen-placeholder",name:"screen_width"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-start-time",name:"form_start_time"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-end-time",name:"form_end_time"}),(0,m.jsx)("input",{type:"hidden",className:"eipsi-current-page",name:"current_page",value:"1"}),(0,m.jsx)("div",{...B}),(0,m.jsxs)("div",{className:"form-navigation",children:[j&&(0,m.jsx)("div",{className:"form-nav-left",children:(0,m.jsx)("button",{type:"button",className:"eipsi-prev-button is-hidden","data-testid":"prev-button","aria-label":"Ir a la p√°gina anterior",children:"Anterior"})}),(0,m.jsxs)("div",{className:"form-nav-right",children:[(0,m.jsx)("button",{type:"button",className:"eipsi-next-button","data-testid":"next-button","aria-label":"Ir a la siguiente p√°gina",children:"Siguiente"}),(0,m.jsx)("button",{type:"submit",className:"eipsi-submit-button is-hidden","data-testid":"submit-button","aria-label":"Enviar el formulario",children:s||"Enviar"})]})]}),C&&(0,m.jsxs)("div",{className:"form-progress",children:["P√°gina ",(0,m.jsx)("span",{className:"current-page",children:"1"})," de"," ",(0,m.jsx)("span",{className:"total-pages",children:"?"})]})]})]})}}),(0,o.registerBlockType)("eipsi/form-page",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{title:o,pageIndex:l}=e,c=(0,n.useSelect)(e=>{const{getBlockRootClientId:i,getBlockOrder:o,getBlock:a}=e("core/block-editor"),t=i(s),r=((t?o(t):o())||[]).filter(e=>{const i=a(e);return"eipsi/form-page"===i?.name}).indexOf(s);return-1===r?null:r+1},[s]);(0,p.useEffect)(()=>{c&&c!==l&&i({pageIndex:c})},[c,l,i]);const d=c||l||1,u=(0,a.useBlockProps)({className:"eipsi-page-editor"}),f=(0,a.useInnerBlocksProps)({className:"eipsi-page-content-editor"},{allowedBlocks:["core/paragraph","core/heading","core/html","core/spacer","core/separator","core/group","core/columns","core/column","core/list","core/list-item","core/image","core/buttons","core/button","eipsi/consent-block","eipsi/campo-texto","eipsi/campo-textarea","eipsi/campo-descripcion","eipsi/campo-select","eipsi/campo-radio","eipsi/campo-multiple","eipsi/campo-likert","eipsi/vas-slider"],templateLock:!1,renderAppender:void 0});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(a.InspectorControls,{children:(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Page Settings","eipsi-forms"),children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("Page Title (Optional)","eipsi-forms"),value:o,onChange:e=>i({title:e}),help:(0,r.__)("Enter an optional title for this page (e.g., Personal Information)","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Page Number","eipsi-forms"),type:"number",value:d,help:(0,r.__)("This page number updates automatically based on block order.","eipsi-forms"),disabled:!0})]})}),(0,m.jsx)("div",{...u,children:(0,m.jsxs)("div",{className:"eipsi-page-preview",children:[(0,m.jsxs)("div",{className:"page-header",children:[(0,m.jsxs)("span",{className:"page-badge",children:[(0,r.__)("Page","eipsi-forms")," ",d]}),o&&(0,m.jsx)("h3",{className:"eipsi-page-title",children:o}),!o&&(0,m.jsx)("p",{className:"page-placeholder-text",children:(0,r.__)("Add a page title in the block settings (optional)","eipsi-forms")})]}),(0,m.jsx)("div",{...f})]})})]})},save:function({attributes:e}){const{title:i,pageIndex:s,className:o,pageType:t,enableRestartButton:n,restartButtonLabel:l}=e,c="thank_you"===t,d=a.useBlockProps.save({className:`eipsi-page ${c?"eipsi-thank-you-page-block":""} ${o||""}`.trim(),"data-page":c?"thank-you":s,"data-page-type":c?"thank_you":"standard",style:{display:c||1!==s?"none":void 0}}),p=a.useInnerBlocksProps.save({className:"eipsi-page-content"});return(0,m.jsxs)("div",{...d,children:[i&&(0,m.jsx)("h3",{className:"eipsi-page-title",children:i}),(0,m.jsx)("div",{...p}),c&&n&&(0,m.jsx)("div",{className:"eipsi-thank-you-restart",children:(0,m.jsx)("button",{type:"button",className:"eipsi-restart-button","data-action":"restart","data-testid":"thank-you-restart-button",children:l||(0,r.__)("Comenzar de nuevo","eipsi-forms")})})]})}});const w=({attributes:e,setAttributes:i})=>{const{titulo:s,contenido:o,textoComplementario:a,mostrarCheckbox:n,etiquetaCheckbox:l,isRequired:c,showTimestamp:d}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.PanelBody,{title:(0,r.__)("üí° Formato de Texto","eipsi-forms"),initialOpen:!0,children:(0,m.jsxs)("div",{style:{padding:"12px",backgroundColor:"#e7f3ff",border:"1px solid #b3d9ff",borderRadius:"4px",fontSize:"12px",lineHeight:"1.7",color:"#0056b3"},children:[(0,m.jsx)("p",{style:{marginBottom:"8px"},children:(0,m.jsx)("strong",{children:"C√≥mo formatear:"})}),(0,m.jsxs)("p",{style:{margin:"6px 0"},children:[(0,m.jsx)("code",{style:{backgroundColor:"#fff",padding:"2px 4px",borderRadius:"2px",color:"#333",fontFamily:"monospace"},children:"*tu texto*"})," ","para ",(0,m.jsx)("strong",{children:"negrita"})]}),(0,m.jsxs)("p",{style:{margin:"6px 0"},children:[(0,m.jsx)("code",{style:{backgroundColor:"#fff",padding:"2px 4px",borderRadius:"2px",color:"#333",fontFamily:"monospace"},children:"_tu texto_"})," ","para ",(0,m.jsx)("em",{children:"it√°lica"})]}),(0,m.jsxs)("p",{style:{margin:"6px 0"},children:[(0,m.jsx)("code",{style:{backgroundColor:"#fff",padding:"2px 4px",borderRadius:"2px",color:"#333",fontFamily:"monospace"},children:"*_tu texto_*"})," ","para"," ",(0,m.jsx)("strong",{children:(0,m.jsx)("em",{children:"negrita + it√°lica"})})]})]})}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Configuraci√≥n del Consentimiento","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("div",{style:{marginBottom:"16px"},children:(0,m.jsx)("p",{style:{fontSize:"13px",color:"#666"},children:(0,r.__)("Bloque de consentimiento informado para investigaciones cl√≠nicas (ANMAT/APA).","eipsi-forms")})}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("T√≠tulo (opcional)","eipsi-forms"),value:s||"",onChange:e=>i({titulo:e}),help:(0,r.__)('Aparece en negrita (ej: "Consentimiento Informado")',"eipsi-forms")}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Contenido","eipsi-forms"),value:o||"",onChange:e=>i({contenido:e}),rows:6,placeholder:(0,r.__)("Escriba el texto completo del consentimiento informado. Incluya: voluntariedad, anonimato, fines cl√≠nicos, derechos del participante.","eipsi-forms"),help:(0,r.__)("Personaliza para cumplir ANMAT/APA. Este es el texto principal que ver√° el paciente. Puedes usar saltos de l√≠nea.","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Texto complementario (opcional)","eipsi-forms"),value:a||"",onChange:e=>i({textoComplementario:e}),help:(0,r.__)("Aparece debajo del contenido principal en estilo discreto.","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Incluir Checkbox de Aceptaci√≥n","eipsi-forms"),checked:n,onChange:e=>i({mostrarCheckbox:e}),help:(0,r.__)("Si activado, muestra un checkbox para que el participante acepte el consentimiento.","eipsi-forms")}),n&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Etiqueta del Checkbox","eipsi-forms"),value:l,onChange:e=>i({etiquetaCheckbox:e}),rows:3,placeholder:(0,r.__)('Ej: "He le√≠do y acepto participar voluntariamente en este estudio."',"eipsi-forms"),help:(0,r.__)("Texto que aparece junto al checkbox.","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Campo Obligatorio","eipsi-forms"),checked:c,onChange:e=>i({isRequired:e}),help:(0,r.__)("Si activado, el participante DEBE marcar el checkbox para continuar.","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Mostrar Marca de Tiempo","eipsi-forms"),checked:d,onChange:e=>i({showTimestamp:e}),help:(0,r.__)("Registra fecha y hora de aceptaci√≥n en metadata para auditor√≠a.","eipsi-forms")})]})]})]})};var S=s(679);const N=e=>{if(!e||""===e.trim())return(0,m.jsx)("p",{className:"eipsi-preview-placeholder",children:(0,r.__)("Escriba el contenido del consentimiento aqu√≠‚Ä¶","eipsi-forms")});const i=e.split("\n");return(0,m.jsx)("div",{className:"eipsi-consent-body",children:i.map((e,i)=>{const s=(0,S.VV)(e);return(0,m.jsx)("p",{dangerouslySetInnerHTML:{__html:s}},`${e}-${i}`)})})},k=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("div",{className:"eipsi-consent-body",children:i.map((e,i)=>{const s=(0,S.VV)(e);return(0,m.jsx)("p",{dangerouslySetInnerHTML:{__html:s}},`${e}-${i}`)})})};(0,o.registerBlockType)("eipsi/consent-block",{edit:function({attributes:e,setAttributes:i}){const{titulo:s,contenido:o,textoComplementario:t,mostrarCheckbox:n,etiquetaCheckbox:l,isRequired:c}=e,[d,u]=(0,p.useState)(null);(0,p.useEffect)(()=>{const e=(0,S.Mg)(o||"");u(e.valid?null:e.error)},[o]);const f=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-consent-field","data-field-type":"consent","data-consent-block":"true","data-required":n&&c?"true":"false"}),h=s||(0,r.__)("Consentimiento Informado","eipsi-forms");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(a.InspectorControls,{children:(0,m.jsx)(w,{attributes:e,setAttributes:i})}),(0,m.jsxs)("div",{...f,children:[h&&(0,m.jsx)("h3",{className:"consent-title",children:h}),d&&(0,m.jsxs)("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",color:"#856404",fontSize:"12px"},children:["‚ö†Ô∏è ",d]}),N(o),t&&(0,m.jsx)("p",{className:"consent-note",children:t}),n&&(0,m.jsxs)("div",{className:"eipsi-consent-checkbox-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",id:"consent-preview-checkbox",disabled:!0,checked:!1}),(0,m.jsxs)("label",{htmlFor:"consent-preview-checkbox",children:[l,c&&(0,m.jsx)("span",{className:"eipsi-required-mark",children:"*"})]})]})]})]})},save:function({attributes:e}){const{titulo:i,contenido:s,textoComplementario:o,mostrarCheckbox:t,etiquetaCheckbox:r,isRequired:n}=e;var l;if(!((l=s,(l||"").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim()).length>0))return null;const c=a.useBlockProps.save({className:"wp-block-eipsi-consent-block eipsi-consent-block form-group","data-consent-block":"true","data-required":t&&n?"true":"false"});return(0,m.jsxs)("div",{...c,children:[i&&(0,m.jsx)("h3",{className:"consent-title",children:(0,m.jsx)(a.RichText.Content,{value:i})}),k(s),o&&(0,m.jsx)("p",{className:"consent-note",children:(0,m.jsx)(a.RichText.Content,{value:o})}),t&&(0,m.jsxs)("div",{className:"consent-control",children:[(0,m.jsxs)("div",{className:"eipsi-consent-checkbox-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",id:"eipsi-consent-checkbox",name:"eipsi_consent_accepted",className:"eipsi-consent-checkbox",required:n,"data-required":n?"true":"false","data-testid":"input-eipsi_consent_accepted"}),(0,m.jsxs)("label",{htmlFor:"eipsi-consent-checkbox",children:[r,n&&(0,m.jsx)("span",{className:"eipsi-required-mark",children:"*"})]})]}),(0,m.jsx)("div",{className:"form-error",style:{display:"none"}})]})]})},attributes:{titulo:{type:"string",default:""},contenido:{type:"string",default:"Acepto participar voluntariamente en este estudio de investigaci√≥n. He sido informado sobre los objetivos, procedimientos, riesgos y beneficios. Entiendo que mi participaci√≥n es completamente voluntaria y puedo retirarme en cualquier momento sin penalizaci√≥n. Mis datos ser√°n tratados de forma an√≥nima y confidencial seg√∫n las normativas ANMAT y APA."},textoComplementario:{type:"string",default:""},mostrarCheckbox:{type:"boolean",default:!0},etiquetaCheckbox:{type:"string",default:"He le√≠do y acepto participar voluntariamente"},isRequired:{type:"boolean",default:!0},showTimestamp:{type:"boolean",default:!1}}});const I=({attributes:e,setAttributes:i,showPlaceholder:s=!0})=>{const{fieldName:o,label:a,required:n,placeholder:l,helperText:c}=e;return(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Field Settings","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("Field Name / Slug","eipsi-forms"),value:o||"",onChange:e=>i({fieldName:e}),help:(0,r.__)("Used as the input name attribute (e.g., full_name)","eipsi-forms")}),(0,m.jsx)("div",{style:{marginTop:"16px",marginBottom:"8px"},children:(0,m.jsx)("strong",{children:(0,r.__)("Texto que ve el paciente","eipsi-forms")})}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Label (t√≠tulo del campo)","eipsi-forms"),value:a||"",onChange:e=>i({label:e}),help:(0,r.__)("Aparece en negrita sobre el campo","eipsi-forms")}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Descripci√≥n / Helper text","eipsi-forms"),value:c||"",onChange:e=>i({helperText:e}),rows:4,help:(0,r.__)("Texto de ayuda permanente que se muestra debajo del campo. Ideal para instrucciones cl√≠nicas.","eipsi-forms")}),s&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:{marginTop:"16px",marginBottom:"8px"},children:(0,m.jsx)("strong",{children:(0,r.__)("Placeholder (opcional)","eipsi-forms")})}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Texto fantasma (desaparece al escribir)","eipsi-forms"),value:l||"",onChange:e=>i({placeholder:e}),help:(0,r.__)('Ejemplo: "Escribe tu respuesta aqu√≠‚Ä¶"',"eipsi-forms")})]}),(0,m.jsx)("div",{style:{marginTop:"16px",marginBottom:"8px"},children:(0,m.jsx)("strong",{children:(0,r.__)("Validaci√≥n","eipsi-forms")})}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Campo obligatorio","eipsi-forms"),checked:!!n,onChange:e=>i({required:!!e}),help:(0,r.__)("Si est√° activo, el paciente debe completar este campo","eipsi-forms")})]})},B=[{label:(0,r.__)("Text","eipsi-forms"),value:"text"},{label:(0,r.__)("Email","eipsi-forms"),value:"email"},{label:(0,r.__)("Number","eipsi-forms"),value:"number"},{label:(0,r.__)("Telephone","eipsi-forms"),value:"tel"},{label:(0,r.__)("URL","eipsi-forms"),value:"url"},{label:(0,r.__)("Date","eipsi-forms"),value:"date"}],T=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},P=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/campo-texto",{edit:function({attributes:e,setAttributes:i}){const{fieldName:s,label:o,required:n,placeholder:l,helperText:c,fieldType:d}=e,p=s&&""!==s.trim()?s.trim():void 0,u=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-text-field","data-field-name":p,"data-required":n?"true":"false","data-field-type":d||"text"}),f=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(p),h=o&&""!==o.trim()?o:(0,r.__)("Campo de texto","eipsi-forms");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(I,{attributes:e,setAttributes:i}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Text Field Options","eipsi-forms"),initialOpen:!1,children:(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Input type","eipsi-forms"),value:d,options:B,onChange:e=>i({fieldType:e})})})]}),(0,m.jsxs)("div",{...u,children:[(0,m.jsx)("label",{className:n?"required":void 0,htmlFor:f,children:h}),(0,m.jsx)("input",{type:d||"text",name:p,id:f,placeholder:l||"",required:n,"data-required":n?"true":"false","data-field-type":d||"text",disabled:!0}),T(c),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})]})},save:function({attributes:e}){const{fieldName:i,label:s,required:o,placeholder:t,helperText:r,fieldType:n}=e,l=i&&""!==i.trim()?i.trim():void 0,c=a.useBlockProps.save({className:"form-group eipsi-field eipsi-text-field","data-field-name":l,"data-required":o?"true":"false","data-field-type":n||"text"}),d=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(l),p=n||"text";return(0,m.jsxs)("div",{...c,children:[s&&(0,m.jsx)("label",{className:o?"required":void 0,htmlFor:d,children:s}),(0,m.jsx)("input",{type:p,name:l,id:d,placeholder:t||"",required:o,"data-required":o?"true":"false","data-field-type":p}),P(r),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})}});const F=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},A=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/campo-textarea",{edit:function({attributes:e,setAttributes:i}){const{fieldName:s,label:o,required:n,placeholder:l,helperText:c,rows:d}=e,p=s&&""!==s.trim()?s.trim():void 0,u=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-textarea-field","data-field-name":p,"data-required":n?"true":"false","data-field-type":"textarea"}),f=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(p),h=o||(0,r.__)("Campo textarea","eipsi-forms"),g=Number(d)||4;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(I,{attributes:e,setAttributes:i}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Textarea Options","eipsi-forms"),initialOpen:!1,children:(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Rows","eipsi-forms"),value:g,onChange:e=>i({rows:Number(e)||4}),min:2,max:12})})]}),(0,m.jsxs)("div",{...u,children:[(0,m.jsx)("label",{className:n?"required":void 0,htmlFor:f,children:h}),(0,m.jsx)("textarea",{name:p,id:f,placeholder:l||"",required:n,rows:g,"data-required":n?"true":"false","data-field-type":"textarea",disabled:!0}),F(c),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})]})},save:function({attributes:e}){const{fieldName:i,label:s,required:o,placeholder:t,helperText:r,rows:n}=e,l=i&&""!==i.trim()?i.trim():void 0,c=a.useBlockProps.save({className:"form-group eipsi-field eipsi-textarea-field","data-field-name":l,"data-required":o?"true":"false","data-field-type":"textarea"}),d=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(l),p=Number(n)||4;return(0,m.jsxs)("div",{...c,children:[s&&(0,m.jsx)("label",{className:o?"required":void 0,htmlFor:d,children:s}),(0,m.jsx)("textarea",{name:l,id:d,placeholder:t||"",required:o,rows:p,"data-required":o?"true":"false","data-field-type":"textarea"}),A(r),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})}});const $=({attributes:e,setAttributes:i})=>{const{label:s,helperText:o,placeholder:a}=e;return(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Description Settings","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)("div",{style:{marginBottom:"16px"},children:(0,m.jsx)("p",{style:{fontSize:"13px",color:"#666"},children:(0,r.__)("Este bloque es solo informativo ‚Äî no captura respuestas del paciente.","eipsi-forms")})}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("T√≠tulo","eipsi-forms"),value:s||"",onChange:e=>i({label:e}),help:(0,r.__)('Aparece en negrita (ej: "Instrucciones importantes")',"eipsi-forms")}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Contenido","eipsi-forms"),value:o||"",onChange:e=>i({helperText:e}),rows:6,help:(0,r.__)("Texto principal que ver√° el paciente. Puedes usar saltos de l√≠nea.","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Texto complementario (opcional)","eipsi-forms"),value:a||"",onChange:e=>i({placeholder:e}),help:(0,r.__)("Aparece debajo del contenido principal en estilo discreto.","eipsi-forms")})]})},E=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("div",{className:"description-body",children:i.map((e,i)=>(0,m.jsx)("p",{children:e},`${e}-${i}`))})},z=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("div",{className:"description-body",children:i.map((e,i)=>(0,m.jsx)("p",{children:e},`${e}-${i}`))})};function R(e){return e?e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"):""}function O(e){if(!e||""===e.trim())return[];const i=R(e);return i.includes(";")?i.split(";").map(e=>e.trim()).filter(e=>""!==e):i.includes("\n")?i.split("\n").map(e=>e.trim()).filter(e=>""!==e):function(e){const i=[];let s="",o=!1,a=0;for(;a<e.length;){const t=e[a],r=e[a+1];if('"'!==t){if(","===t&&!o){const e=s.trim();""!==e&&i.push(e),s="",a++;continue}s+=t,a++}else{if(o&&'"'===r){s+='"',a+=2;continue}o=!o,a++}}const t=s.trim();return""!==t&&i.push(t),i}(i)}(0,o.registerBlockType)("eipsi/campo-descripcion",{edit:function({attributes:e,setAttributes:i}){const{label:s,placeholder:o,helperText:t}=e,n=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-description-field","data-field-type":"description"}),l=s||(0,r.__)("Campo descripci√≥n","eipsi-forms");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(a.InspectorControls,{children:(0,m.jsx)($,{attributes:e,setAttributes:i})}),(0,m.jsxs)("div",{...n,children:[l&&(0,m.jsx)("h3",{className:"description-title",children:l}),E(t),o&&(0,m.jsx)("p",{className:"description-note",children:o})]})]})},save:function({attributes:e}){const{label:i,placeholder:s,helperText:o}=e,t=a.useBlockProps.save({className:"form-group eipsi-field eipsi-description-field","data-field-type":"description"});return(0,m.jsxs)("div",{...t,children:[i&&(0,m.jsx)("h3",{className:"description-title",children:i}),z(o),s&&(0,m.jsx)("p",{className:"description-note",children:s})]})}});const q=[{label:(0,r.__)("Y (AND)","eipsi-forms"),value:"AND"},{label:(0,r.__)("O (OR)","eipsi-forms"),value:"OR"}],L=[{label:(0,r.__)("Mayor o igual (‚â•)","eipsi-forms"),value:">="},{label:(0,r.__)("Menor o igual (‚â§)","eipsi-forms"),value:"<="},{label:(0,r.__)("Mayor que (>)","eipsi-forms"),value:">"},{label:(0,r.__)("Menor que (<)","eipsi-forms"),value:"<"},{label:(0,r.__)("Igual a (=)","eipsi-forms"),value:"=="}],M={"eipsi/campo-radio":{type:"discrete",getOptions:e=>O(e.options)},"eipsi/campo-select":{type:"discrete",getOptions:e=>O(e.options)},"eipsi/campo-multiple":{type:"discrete",getOptions:e=>O(e.options)},"eipsi/campo-likert":{type:"discrete",getOptions:e=>function(e){const{minValue:i=1,maxValue:s=5,labels:o=""}=e,a=o?o.split(",").map(e=>e.trim()).filter(Boolean):[],t=[];for(let e=i;e<=s;e++){const s=a[e-i]?`${e} ‚Äì ${a[e-i]}`:e.toString();t.push(s)}return t}(e)},"eipsi/vas-slider":{type:"numeric",getRange:e=>function(e){const i="number"==typeof e.minValue?e.minValue:0,s="number"==typeof e.maxValue?e.maxValue:i+10;return{min:i,max:s>i?s:i+10}}(e)}};function D(e={}){const{fieldName:i,fieldKey:s}=e;return i&&""!==i.trim()?i.trim():s&&""!==s.trim()?s.trim():""}function V(e){if(!e||!Array.isArray(e.innerBlocks))return[];const i=[],s=e=>{e.forEach(e=>{const o=M[e.name];if(o){const s=D(e.attributes);if(s){const a={fieldId:s,label:e.attributes.label||e.attributes.fieldName||(0,r.__)("Campo sin nombre","eipsi-forms"),type:o.type};if("discrete"===o.type){const i=o.getOptions(e.attributes);a.options=i.map(e=>({label:e,value:e}))}else if("numeric"===o.type){const i=o.getRange(e.attributes);a.min=i.min,a.max=i.max}i.push(a)}}e.innerBlocks&&e.innerBlocks.length>0&&s(e.innerBlocks)})};return s(e.innerBlocks),i}function H(e,i="discrete"){var s;const o=e?.type?"numeric"===e.type:"numeric"===i;return{id:`cond-${Date.now()}-${Math.floor(1e3*Math.random())}`,fieldId:e?.fieldId||"",fieldLabel:e?.label||"",fieldType:o?"numeric":"discrete",operator:o?">=":"==",value:o?void 0:"",threshold:o?null!==(s=e?.min)&&void 0!==s?s:0:void 0,logicalOperator:"AND"}}const U=({attributes:e,setAttributes:i,clientId:s,mode:o="discrete"})=>{const{conditionalLogic:a}=e,[l,c]=(0,p.useState)({}),d=D(e),u="numeric"===o?"numeric":"discrete",f=(0,p.useMemo)(()=>function(e,i,s){if(!e)return{enabled:!1,rules:[],defaultAction:"nextPage"};const o=(e={},s=0)=>{var o,a,t,r;const n="numeric"===e.fieldType||">="===e.operator||"<="===e.operator||">"===e.operator||"<"===e.operator;return{id:e.id||`cond-${s}`,fieldId:e.fieldId||i,fieldLabel:e.fieldLabel||"",fieldType:n?"numeric":"discrete",operator:e.operator||(n?">=":"=="),value:n?void 0:null!==(o=null!==(a=e.value)&&void 0!==a?a:e.matchValue)&&void 0!==o?o:"",threshold:n?null!==(t=null!==(r=e.threshold)&&void 0!==r?r:e.value)&&void 0!==t?t:null:void 0,logicalOperator:e.logicalOperator||"AND"}},a=(e={},a=0)=>{const t={id:e.id||`rule-${a}`,action:e.action||"nextPage",targetPage:e.targetPage||null};return Array.isArray(e.conditions)&&e.conditions.length>0?{...t,conditions:e.conditions.map((e,i)=>o(e,`${a}-${i}`))}:e.operator&&void 0!==e.threshold?{...t,conditions:[o({fieldId:e.fieldId||i,fieldType:"numeric",operator:e.operator,threshold:null!==(r=null!==(n=e.threshold)&&void 0!==n?n:e.valueThreshold)&&void 0!==r?r:null},`${a}-0`)]}:void 0!==e.matchValue||void 0!==e.value?{...t,conditions:[o({fieldId:e.fieldId||i,fieldType:"discrete",operator:"==",value:null!==(l=null!==(c=e.matchValue)&&void 0!==c?c:e.value)&&void 0!==l?l:""},`${a}-0`)]}:{...t,conditions:[H(null,s)]};var r,n,l,c};if(Array.isArray(e))return{enabled:e.length>0,rules:e.map((e,i)=>a(e,i)),defaultAction:"nextPage"};if("object"==typeof e){const i=Array.isArray(e.rules)?e.rules:[];return{enabled:!1!==e.enabled,rules:i.map((e,i)=>a(e,i)),defaultAction:e.defaultAction||"nextPage",defaultTargetPage:e.defaultTargetPage||null}}return{enabled:!1,rules:[],defaultAction:"nextPage"}}(a,d,u),[a,d,u]),{pages:h,hasPages:g,availableFields:x}=(0,n.useSelect)(e=>{const{getSelectedBlock:i,getBlockParentsByBlockName:o,getBlock:a}=e("core/block-editor"),t=s?a(s):i();if(!t)return{pages:[],hasPages:!1,availableFields:[]};const r=o(t.clientId,"eipsi/form-container");if(0===r.length)return{pages:[],hasPages:!1,availableFields:[]};const n=a(r[r.length-1]);if(!n||!n.innerBlocks)return{pages:[],hasPages:!1,availableFields:[]};const l=n.innerBlocks.filter(e=>"eipsi/form-page"===e.name).map((e,i)=>({index:i+1,title:e.attributes.title||"",clientId:e.clientId})),c=o(t.clientId,"eipsi/form-page"),d=c.length>0?c[c.length-1]:null,p=d?a(d):null;return{pages:l,hasPages:l.length>0,availableFields:V(p)}},[s]),b=(0,p.useMemo)(()=>{const e={};return x.forEach(i=>{i.fieldId&&(e[i.fieldId]=i)}),e},[x]),_=(0,p.useMemo)(()=>{const e=[{label:(0,r.__)("Selecciona un campo‚Ä¶","eipsi-forms"),value:""}];return x.forEach(i=>{e.push({label:i.label,value:i.fieldId})}),e},[x]),y=g&&x.length>0,v=(0,p.useCallback)(e=>{const i={};e.forEach((e,s)=>{if(Array.isArray(e.conditions)&&0!==e.conditions.length){for(let o=0;o<e.conditions.length;o++){const a=e.conditions[o],t=a.fieldId?b[a.fieldId]:null;if(!t){i[s]=(0,r.__)("Selecciona un campo v√°lido para esta condici√≥n","eipsi-forms");break}if("numeric"===t.type){if(!a.operator){i[s]=(0,r.__)("Elig√≠ un operador num√©rico","eipsi-forms");break}const e=parseFloat(a.threshold);if(Number.isNaN(e)){i[s]=(0,r.__)("Ingres√° un valor num√©rico v√°lido","eipsi-forms");break}}else if(!a.value){i[s]=(0,r.__)("Selecciona el valor que dispara la condici√≥n","eipsi-forms");break}}"goToPage"===e.action&&(!e.targetPage||e.targetPage<1)&&(i[s]=(0,r.__)("Eleg√≠ una p√°gina de destino v√°lida","eipsi-forms"))}else i[s]=(0,r.__)("Cada regla necesita al menos una condici√≥n","eipsi-forms")}),c(i)},[b]);(0,p.useEffect)(()=>{f.enabled&&f.rules.length>0?v(f.rules):c({})},[f.enabled,f.rules,x,h,v]);const j=(e,s)=>{const o=f.rules.map((i,o)=>o!==e?i:{...i,...s});i({conditionalLogic:{...f,rules:o}})},C=(e,s,o)=>{const a=f.rules.map((i,a)=>{if(a!==e)return i;const t=i.conditions.map((e,i)=>i!==s?e:{...e,...o});return{...i,conditions:t}});i({conditionalLogic:{...f,rules:a}})},w=(e,s=null)=>{const o={...f,defaultAction:e};"goToPage"===e&&s?o.defaultTargetPage=parseInt(s,10):delete o.defaultTargetPage,i({conditionalLogic:o})},S=()=>0===h.length?[{label:(0,r.__)("No hay p√°ginas disponibles","eipsi-forms"),value:"",disabled:!0}]:h.map(e=>({label:e.title?`${(0,r.__)("P√°gina","eipsi-forms")} ${e.index} ‚Äì ${e.title}`:`${(0,r.__)("P√°gina","eipsi-forms")} ${e.index}`,value:e.index.toString()})),N=()=>{const e=[{label:(0,r.__)("Siguiente p√°gina","eipsi-forms"),value:"nextPage"},{label:(0,r.__)("Finalizar formulario","eipsi-forms"),value:"submit"}];return h.length>0&&e.splice(1,0,{label:(0,r.__)("Ir a p√°gina espec√≠fica‚Ä¶","eipsi-forms"),value:"goToPage"}),e};return(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("L√≥gica Condicional","eipsi-forms"),initialOpen:!1,children:[(0,m.jsx)("div",{className:"conditional-logic-toggle-wrapper",children:(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Habilitar l√≥gica condicional","eipsi-forms"),checked:f.enabled||!1,onChange:e=>{e?i({conditionalLogic:{enabled:!0,rules:[],defaultAction:"nextPage"}}):(i({conditionalLogic:null}),c({}))},help:(0,r.__)("Configura saltos y visibilidad seg√∫n las respuestas del paciente.","eipsi-forms")})}),f.enabled&&(0,m.jsxs)("div",{className:"conditional-logic-panel",children:[!g&&(0,m.jsx)("div",{className:"conditional-logic-warning",children:(0,m.jsx)("p",{children:(0,r.__)("Para configurar la l√≥gica condicional, primero agreg√° p√°ginas al formulario.","eipsi-forms")})}),g&&0===x.length&&(0,m.jsx)("div",{className:"conditional-logic-warning",children:(0,m.jsx)("p",{children:(0,r.__)("Agreg√° campos compatibles en esta p√°gina (select, radio, m√∫ltiple, likert o VAS) para crear reglas.","eipsi-forms")})}),y&&0===f.rules.length&&(0,m.jsxs)("div",{className:"conditional-logic-empty-state",children:[(0,m.jsx)(t.Dashicon,{icon:"randomize"}),(0,m.jsx)("p",{children:(0,r.__)("Cre√° reglas para saltar p√°ginas, ocultar bloques o finalizar seg√∫n combinaciones de respuestas en esta p√°gina.","eipsi-forms")})]}),f.rules.map((e,s)=>(0,m.jsxs)("div",{className:"conditional-logic-rule",children:[(0,m.jsx)("div",{className:"conditional-logic-rule-header",children:(0,m.jsxs)("h4",{children:[(0,r.__)("Regla","eipsi-forms")," ",s+1]})}),e.conditions.map((e,o)=>((e,s,o)=>{const a=s.fieldId?b[s.fieldId]:null,n=a?.options||[],l=0===o?(0,r.__)("Si se cumple","eipsi-forms"):(0,r.__)("Unir con","eipsi-forms"),c=f.rules[e];return(0,m.jsxs)("div",{className:"conditional-logic-condition",children:[o>0&&(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Operador l√≥gico","eipsi-forms"),value:s.logicalOperator||"AND",options:q,onChange:i=>C(e,o,{logicalOperator:i})}),(0,m.jsx)(t.SelectControl,{label:l,value:s.fieldId||"",options:_,onChange:i=>((e,i,s)=>{const o=H(b[s]||null,u);C(e,i,{...o,logicalOperator:f.rules[e].conditions[i]?.logicalOperator||"AND",fieldId:s})})(e,o,i)}),a&&"discrete"===a.type&&(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Cuando el valor sea","eipsi-forms"),value:s.value||"",options:[{label:(0,r.__)("Selecciona un valor‚Ä¶","eipsi-forms"),value:""},...n],onChange:i=>C(e,o,{value:i,fieldType:"discrete"})}),a&&"numeric"===a.type&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Comparar cuando el valor sea","eipsi-forms"),value:s.operator||">=",options:L,onChange:i=>C(e,o,{operator:i,fieldType:"numeric"})}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Valor umbral","eipsi-forms"),type:"number",value:void 0!==s.threshold&&null!==s.threshold?String(s.threshold):"",onChange:i=>{const s=""===i||null===i?"":parseFloat(i);if(""===i||Number.isNaN(s))return void C(e,o,{threshold:""});let t=s;void 0!==a.min&&(t=Math.max(a.min,t)),void 0!==a.max&&(t=Math.min(a.max,t)),C(e,o,{threshold:t,fieldType:"numeric"})},min:a.min,max:a.max,step:"any"})]}),!a&&(0,m.jsx)("div",{className:"conditional-logic-warning",children:(0,m.jsx)("p",{children:(0,r.__)("Este campo ya no est√° disponible en la p√°gina. Seleccion√° otro campo para continuar.","eipsi-forms")})}),c&&c.conditions.length>1&&(0,m.jsx)(t.Button,{isLink:!0,isDestructive:!0,onClick:()=>((e,s)=>{const o=f.rules.map((i,o)=>{if(o!==e)return i;const a=i.conditions.filter((e,i)=>i!==s);return{...i,conditions:0===a.length?[H(b[d],u)]:a}});i({conditionalLogic:{...f,rules:o}})})(e,o),children:(0,r.__)("Eliminar condici√≥n","eipsi-forms")})]},s.id||`${e}-${o}`)})(s,e,o)),e.conditions.length<3&&(0,m.jsx)(t.Button,{variant:"secondary",onClick:()=>(e=>{const s=b[d]||x[0]||null,o=f.rules.map((i,o)=>{if(o!==e)return i;const a=H(s,u);return{...i,conditions:[...i.conditions,a].slice(0,3)}});i({conditionalLogic:{...f,rules:o}})})(s),className:"conditional-logic-add-condition-button",children:(0,r.__)("+ Combinar (Y/O)","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Entonces","eipsi-forms"),value:e.action||"nextPage",options:N(),onChange:i=>{"nextPage"===i?j(s,{action:"nextPage",targetPage:null}):"submit"===i?j(s,{action:"submit",targetPage:null}):"goToPage"===i&&j(s,{action:"goToPage",targetPage:e.targetPage||h[0]?.index||1})}}),"goToPage"===e.action&&(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Ir a la p√°gina","eipsi-forms"),value:e.targetPage?e.targetPage.toString():"",options:S(),onChange:e=>j(s,{targetPage:parseInt(e,10)})}),l[s]&&(0,m.jsxs)("div",{className:"conditional-logic-validation-error",children:[(0,m.jsx)(t.Dashicon,{icon:"warning"}),(0,m.jsx)("span",{children:l[s]})]}),(0,m.jsx)("div",{className:"conditional-logic-rule-actions",children:(0,m.jsx)(t.Button,{isDestructive:!0,isSmall:!0,onClick:()=>(e=>{const s=f.rules.filter((i,s)=>s!==e);if(0===s.length)return i({conditionalLogic:null}),void c({});i({conditionalLogic:{...f,rules:s}})})(s),children:(0,r.__)("Eliminar regla","eipsi-forms")})})]},e.id||s)),y&&f.rules.length>0&&(0,m.jsxs)("div",{className:"conditional-logic-default-action",children:[(0,m.jsx)("h4",{children:(0,r.__)("Acci√≥n predeterminada","eipsi-forms")}),(0,m.jsx)("p",{children:(0,r.__)("Qu√© ocurre cuando ninguna condici√≥n coincide.","eipsi-forms")}),(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Para otros casos","eipsi-forms"),value:"goToPage"===f.defaultAction?"goToPage":f.defaultAction||"nextPage",options:N(),onChange:e=>{"goToPage"===e?w(e,h[0]?.index||1):w(e)}}),"goToPage"===f.defaultAction&&(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Ir a la p√°gina","eipsi-forms"),value:f.defaultTargetPage?f.defaultTargetPage.toString():h[0]?.index.toString()||"1",options:S(),onChange:e=>w("goToPage",e)})]}),(0,m.jsx)(t.Button,{isPrimary:!0,isSmall:!0,onClick:()=>{const e=b[d]||x[0]||null,s={id:`rule-${Date.now()}`,conditions:[H(e,u)],action:"nextPage",targetPage:null},o=[...f.rules,s];i({conditionalLogic:{...f,rules:o}})},disabled:!y,className:"conditional-logic-add-rule-button",children:(0,r.__)("+ Agregar regla","eipsi-forms")}),y&&(0,m.jsx)("div",{className:"conditional-logic-info",children:(0,m.jsx)("p",{children:(0,r.__)("Las reglas se eval√∫an en orden. La primera coincidencia define el camino del participante.","eipsi-forms")})})]})]})},W=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},G=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/campo-select",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{fieldName:o,label:n,required:l,placeholder:c,helperText:d,options:p,conditionalLogic:u}=e,f=o&&""!==o.trim()?o.trim():void 0,h=u&&(Array.isArray(u)?u.length>0:u.enabled&&u.rules&&u.rules.length>0),g=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-select-field","data-field-name":f,"data-required":l?"true":"false","data-field-type":"select","data-conditional-logic":h?"true":void 0}),x=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(f),b=n&&""!==n.trim()?n:(0,r.__)("Campo de selecci√≥n","eipsi-forms"),_=O(p);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(I,{attributes:e,setAttributes:i}),(0,m.jsx)(U,{attributes:e,setAttributes:i,options:_,clientId:s}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Select Options","eipsi-forms"),initialOpen:!0,children:(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Options (separated by semicolon)","eipsi-forms"),value:p||"",onChange:e=>{i({options:R(e)})},help:(0,r.__)("Separ√° las opciones con punto y coma (;). Las comas dentro de cada opci√≥n son totalmente seguras. Formatos anteriores (l√≠neas o comas) siguen funcionando.","eipsi-forms"),placeholder:"S√≠, absolutamente; S√≠, pero no tan frecuente; No, no ocurre a menudo; Nunca",rows:8})})]}),(0,m.jsxs)("div",{...g,children:[(0,m.jsx)("label",{className:l?"required":void 0,htmlFor:x,children:b}),(0,m.jsxs)("select",{name:f,id:x,required:l,"data-required":l?"true":"false","data-field-type":"select",disabled:!0,children:[c&&""!==c.trim()&&(0,m.jsx)("option",{value:"",children:c}),_.length>0?_.map((e,i)=>(0,m.jsx)("option",{value:e,children:e},i)):(0,m.jsx)("option",{value:"",children:(0,r.__)("Add options in the sidebar","eipsi-forms")})]}),W(d),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})]})},save:function({attributes:e}){const{fieldName:i,label:s,required:o,placeholder:t,helperText:r,options:n,conditionalLogic:l}=e,c=i&&""!==i.trim()?i.trim():void 0,d=a.useBlockProps.save({className:"form-group eipsi-field eipsi-select-field","data-field-name":c,"data-required":o?"true":"false","data-field-type":"select","data-conditional-logic":l?JSON.stringify(l):void 0}),p=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(c),u=O(n);return(0,m.jsxs)("div",{...d,children:[s&&(0,m.jsx)("label",{className:o?"required":void 0,htmlFor:p,children:s}),(0,m.jsxs)("select",{name:c,id:p,required:o,"data-required":o?"true":"false","data-field-type":"select",children:[t&&""!==t.trim()&&(0,m.jsx)("option",{value:"",disabled:!0,selected:!0,children:t}),u.map((e,i)=>(0,m.jsx)("option",{value:e,children:e},i))]}),G(r),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})}});const J=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},Z=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/campo-radio",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{fieldKey:o,fieldName:n,label:l,required:c,helperText:d,options:u,conditionalLogic:f}=e;(0,p.useEffect)(()=>{if(!o){const e=`radio-${s.replace(/[^a-zA-Z0-9]/g,"")}`;i({fieldKey:e})}},[o,s,i]);const h=n&&""!==n.trim()?n.trim():o,g=f&&(Array.isArray(f)?f.length>0:f.enabled&&f.rules&&f.rules.length>0),x=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-radio-field","data-field-name":h||void 0,"data-required":c?"true":"false","data-field-type":"radio","data-conditional-logic":g?"true":void 0}),b=l&&""!==l.trim()?l:(0,r.__)("Campo de opciones","eipsi-forms"),_=O(u);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(I,{attributes:e,setAttributes:i,showPlaceholder:!1}),(0,m.jsx)(U,{attributes:e,setAttributes:i,options:_,clientId:s}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Radio Options","eipsi-forms"),initialOpen:!0,children:(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Options (separated by semicolon)","eipsi-forms"),value:u||"",onChange:e=>{i({options:R(e)})},help:(0,r.__)("Separ√° las opciones con punto y coma (;). Las comas dentro de cada opci√≥n son totalmente seguras. Formatos anteriores (l√≠neas o comas) siguen funcionando.","eipsi-forms"),placeholder:"S√≠, absolutamente; S√≠, pero no tan frecuente; No, no ocurre a menudo; Nunca",rows:8})})]}),(0,m.jsx)("div",{...x,children:(0,m.jsxs)("fieldset",{children:[(0,m.jsx)("legend",{className:c?"required":void 0,children:b}),(0,m.jsx)("ul",{className:"radio-list",children:_.length>0?_.map((e,i)=>{const s=((e,i="")=>{if(!e||""===e.trim())return;const s=e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-");return i?`field-${s}-${i}`:`field-${s}`})(h,i.toString());return(0,m.jsx)("li",{children:(0,m.jsxs)("label",{htmlFor:s,className:"radio-label-wrapper",children:[(0,m.jsx)("input",{type:"radio",name:h,id:s,value:e,required:c,"data-required":c?"true":"false","data-field-type":"radio",disabled:!0}),(0,m.jsx)("span",{className:"radio-label-text",children:e})]})},i)}):(0,m.jsx)("li",{className:"empty-state",children:(0,r.__)("Add options in the sidebar","eipsi-forms")})}),J(d),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})})]})},save:function({attributes:e}){const{fieldKey:i,fieldName:s,label:o,required:t,helperText:r,options:n,conditionalLogic:l}=e,c=s&&""!==s.trim()?s.trim():i,d=a.useBlockProps.save({className:"form-group eipsi-field eipsi-radio-field","data-field-name":c||void 0,"data-required":t?"true":"false","data-field-type":"radio","data-conditional-logic":l?JSON.stringify(l):void 0}),p=O(n);return(0,m.jsx)("div",{...d,children:(0,m.jsxs)("fieldset",{children:[o&&(0,m.jsx)("legend",{className:t?"required":void 0,children:o}),(0,m.jsx)("ul",{className:"radio-list",children:p.map((e,i)=>{const s=((e,i="")=>{if(!e||""===e.trim())return;const s=e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-");return i?`field-${s}-${i}`:`field-${s}`})(c,i.toString());return(0,m.jsx)("li",{children:(0,m.jsxs)("label",{htmlFor:s,className:"radio-label-wrapper",children:[(0,m.jsx)("input",{type:"radio",name:c,id:s,value:e,required:t,"data-required":t?"true":"false","data-field-type":"radio"}),(0,m.jsx)("span",{className:"radio-label-text",children:e})]})},i)})}),Z(r),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})})}});const K=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},Y=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/campo-multiple",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{fieldName:o,label:n,required:l,helperText:c,options:d,conditionalLogic:p}=e,u=o&&""!==o.trim()?o.trim():void 0,f=p&&(Array.isArray(p)?p.length>0:p.enabled&&p.rules&&p.rules.length>0),h=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-checkbox-field","data-field-name":u,"data-required":l?"true":"false","data-field-type":"checkbox","data-conditional-logic":f?"true":void 0}),g=n&&""!==n.trim()?n:(0,r.__)("Campo de selecci√≥n m√∫ltiple","eipsi-forms"),x=O(d);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(I,{attributes:e,setAttributes:i,showPlaceholder:!1}),(0,m.jsx)(U,{attributes:e,setAttributes:i,options:x,clientId:s}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Checkbox Options","eipsi-forms"),initialOpen:!0,children:(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Options (separated by semicolon)","eipsi-forms"),value:d||"",onChange:e=>{i({options:R(e)})},help:(0,r.__)("Separ√° las opciones con punto y coma (;). Las comas dentro de cada opci√≥n son totalmente seguras. Formatos anteriores (l√≠neas o comas) siguen funcionando.","eipsi-forms"),placeholder:"S√≠, absolutamente; S√≠, pero no tan frecuente; No, no ocurre a menudo; Nunca",rows:8})})]}),(0,m.jsx)("div",{...h,children:(0,m.jsxs)("fieldset",{children:[(0,m.jsx)("legend",{className:l?"required":void 0,children:g}),(0,m.jsx)("ul",{className:"checkbox-list",children:x.length>0?x.map((e,i)=>{const s=((e,i="")=>{if(!e||""===e.trim())return;const s=e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-");return i?`field-${s}-${i}`:`field-${s}`})(u,i.toString());return(0,m.jsx)("li",{children:(0,m.jsxs)("label",{htmlFor:s,className:"checkbox-label-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:`${u}[]`,id:s,value:e,"data-required":l?"true":"false","data-field-type":"checkbox",disabled:!0}),(0,m.jsx)("span",{className:"checkbox-label-text",children:e})]})},i)}):(0,m.jsx)("li",{className:"empty-state",children:(0,r.__)("Add options in the sidebar","eipsi-forms")})}),K(c),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})})]})},save:function({attributes:e}){const{fieldName:i,label:s,required:o,helperText:t,options:r,conditionalLogic:n}=e,l=i&&""!==i.trim()?i.trim():void 0,c=a.useBlockProps.save({className:"form-group eipsi-field eipsi-checkbox-field","data-field-name":l,"data-required":o?"true":"false","data-field-type":"checkbox","data-conditional-logic":n?JSON.stringify(n):void 0}),d=O(r);return(0,m.jsx)("div",{...c,children:(0,m.jsxs)("fieldset",{children:[s&&(0,m.jsx)("legend",{className:o?"required":void 0,children:s}),(0,m.jsx)("ul",{className:"checkbox-list",children:d.map((e,i)=>{const s=((e,i="")=>{if(!e||""===e.trim())return;const s=e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-");return i?`field-${s}-${i}`:`field-${s}`})(l,i.toString());return(0,m.jsx)("li",{children:(0,m.jsxs)("label",{htmlFor:s,className:"checkbox-label-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:`${l}[]`,id:s,value:e,"data-required":o?"true":"false","data-field-type":"checkbox"}),(0,m.jsx)("span",{className:"checkbox-label-text",children:e})]})},i)})}),Y(t),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})})}});const X={"likert5-agreement":{name:"Escala de Acuerdo (5 puntos)",minValue:1,maxValue:5,labels:"Totalmente en desacuerdo; En desacuerdo; Neutral; De acuerdo; Totalmente de acuerdo",description:"Evaluaci√≥n de concordancia con afirmaciones",type:"agreement",icon:"ü§ù",color:"#3b82f6"},"likert5-satisfaction":{name:"Escala de Satisfacci√≥n (5 puntos)",minValue:1,maxValue:5,labels:"Muy insatisfecho; Insatisfecho; Neutral; Satisfecho; Muy satisfecho",description:"Medici√≥n de satisfacci√≥n con servicios o productos",type:"satisfaction",icon:"üòä",color:"#10b981"},"likert5-frequency":{name:"Escala de Frecuencia (5 puntos)",minValue:1,maxValue:5,labels:"Nunca; Raramente; A veces; Frecuentemente; Siempre",description:"Evaluaci√≥n de frecuencia de comportamientos/s√≠ntomas",type:"frequency",icon:"üìä",color:"#f59e0b"},"likert7-agreement":{name:"Escala de Acuerdo (7 puntos)",minValue:1,maxValue:7,labels:"Totalmente en desacuerdo; Muy en desacuerdo; En desacuerdo; Neutral; De acuerdo; Muy de acuerdo; Totalmente de acuerdo",description:"Mayor especificidad en evaluaci√≥n de acuerdos",type:"agreement",icon:"ü§ù",color:"#3b82f6"},"likert7-satisfaction":{name:"Escala de Satisfacci√≥n (7 puntos)",minValue:1,maxValue:7,labels:"Muy insatisfecho; Bastante insatisfecho; Algo insatisfecho; Neutral; Algo satisfecho; Bastante satisfecho; Muy satisfecho",description:"Mayor granularidad en medici√≥n de satisfacci√≥n",type:"satisfaction",icon:"üòä",color:"#10b981"},"likert4-agreement":{name:"Escala de Acuerdo (4 puntos)",minValue:1,maxValue:4,labels:"Muy en desacuerdo; En desacuerdo; De acuerdo; Muy de acuerdo",description:"Fuerza decisi√≥n sin punto neutral",type:"agreement",icon:"‚öñÔ∏è",color:"#3b82f6"},custom:{name:"Personalizado",minValue:null,maxValue:null,labels:null,description:"Define tu propia escala",type:"custom",icon:"‚öôÔ∏è",color:"#6b7280"}},Q=e=>X[e]||null,ee=e=>e&&"custom"!==e.key?{minValue:e.minValue,maxValue:e.maxValue,labels:e.labels}:{},ie=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},se=e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`},oe=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},ae=e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`};(0,o.registerBlockType)("eipsi/campo-likert",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{fieldKey:o,fieldName:n,label:l,required:c,helperText:d,minValue:u=1,labels:f,conditionalLogic:h,scaleVariation:g="custom"}=e,x=(e=>{if(!e||""===e.trim())return 5;const i=e.split(";").map(e=>e.trim()).filter(e=>""!==e);return i.length>0?i.length:1})(f),[b,_]=(0,p.useState)(g),[y,v]=(0,p.useState)("custom"!==g);(0,p.useEffect)(()=>{if(!o){const e=`likert-${s.replace(/[^a-zA-Z0-9]/g,"")}`;i({fieldKey:e})}},[o,s,i]);const j=n&&""!==n.trim()?n.trim():o,C=h&&(Array.isArray(h)?h.length>0:h.enabled&&h.rules&&h.rules.length>0),w=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-likert-field "+(y?"using-preset":"custom-mode"),"data-field-name":j,"data-required":c?"true":"false","data-field-type":"likert","data-min":u,"data-max":x,"data-scale-variation":g,"data-conditional-logic":C?"true":void 0}),S=l&&""!==l.trim()?l:(0,r.__)("Escala Likert","eipsi-forms"),N=f?O(f):[],k=[];for(let e=u;e<=x;e++)k.push(e);const I=((e,i,s)=>{if(!e||!e.trim())return{isValid:!0,message:""};const o=e.split(";").filter(e=>e.trim()).length,a=s-i+1;return o!==a?{isValid:!1,message:`Tienes ${o} etiquetas pero ${a} puntos en la escala. Las etiquetas ser√°n ignoradas si el n√∫mero no coincide.`}:{isValid:!0,message:""}})(f,u,x),B=k.map((e,i)=>{const s=e.toString();return{label:N[i]?`${s} ‚Äì ${N[i]}`:s,value:s}}),T=Q(g);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Field Settings","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("Field Name / Slug","eipsi-forms"),value:n||"",onChange:e=>i({fieldName:e}),help:(0,r.__)("Used as the input name attribute (e.g., satisfaction)","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Label","eipsi-forms"),value:l||"",onChange:e=>i({label:e})}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Required field","eipsi-forms"),checked:!!c,onChange:e=>i({required:!!e})}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Helper text","eipsi-forms"),value:d||"",onChange:e=>i({helperText:e}),help:(0,r.__)("Displayed below the field to provide additional guidance.","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("üìä Variaci√≥n de Escala Likert","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Seleccionar Escala Predefinida","eipsi-forms"),value:b,options:[{label:"üîß Personalizado",value:"custom"},{label:"ü§ù Escala de Acuerdo (5 puntos)",value:"likert5-agreement"},{label:"üòä Escala de Satisfacci√≥n (5 puntos)",value:"likert5-satisfaction"},{label:"üìä Escala de Frecuencia (5 puntos)",value:"likert5-frequency"},{label:"ü§ù Escala de Acuerdo (7 puntos)",value:"likert7-agreement"},{label:"üòä Escala de Satisfacci√≥n (7 puntos)",value:"likert7-satisfaction"},{label:"‚öñÔ∏è Escala de Acuerdo (4 puntos)",value:"likert4-agreement"}],onChange:e=>{_(e);const s="custom"===e;if(v(!s),i({scaleVariation:e}),!s){const s=Q(e);if(s){const e=ee(s);i(e)}}},help:(0,r.__)('Las escalas predefinidas configuran autom√°ticamente min/max/etiquetas. Selecciona "Personalizado" para configuraci√≥n manual.',"eipsi-forms")}),T&&"Personalizado"!==T.name&&(0,m.jsxs)("div",{className:"preset-description",style:{padding:"12px",backgroundColor:`${T.color}15`,borderLeft:`4px solid ${T.color}`,borderRadius:"4px",margin:"12px 0"},children:[(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[(0,m.jsx)("span",{style:{fontSize:"18px",marginRight:"8px"},children:T.icon}),(0,m.jsx)("strong",{children:T.name})]}),(0,m.jsx)("p",{style:{margin:"0",fontSize:"13px",color:"#555",lineHeight:"1.4"},children:T.description}),(0,m.jsxs)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#666",display:"flex",justifyContent:"space-between"},children:[(0,m.jsxs)("span",{children:["üìè"," ",T.maxValue-T.minValue+1," ","puntos"]}),(0,m.jsx)("span",{style:{padding:"2px 6px",backgroundColor:T.color,color:"white",borderRadius:"3px",fontSize:"10px"},children:T.type.toUpperCase()})]})]}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Usar valores personalizados","eipsi-forms"),checked:!y,onChange:e=>{if(v(!e),e)i({scaleVariation:"custom"});else if("custom"!==b){const e=Q(b);if(e){const s=ee(e);i(s)}}},help:(0,r.__)("Desactiva para usar la escala predefinida. Act√≠valo para configurar manualmente min/max/etiquetas.","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("‚öôÔ∏è Configuraci√≥n de Escala","eipsi-forms"),initialOpen:!y,children:[(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Etiquetas (separadas por punto y coma)","eipsi-forms"),value:f||"",onChange:e=>i({labels:R(e)}),disabled:y,help:(0,r.__)("Etiquetas opcionales para cada punto de la escala (deben coincidir con la cantidad de puntos). Separ√° con punto y coma (;). Formatos anteriores (l√≠neas o comas) siguen funcionando.","eipsi-forms"),placeholder:"Nada; Poco; Moderado; Bastante; Mucho"}),(0,m.jsxs)("div",{className:"calculated-values",children:[(0,m.jsxs)("div",{className:"calculated-min-value",children:[(0,m.jsx)("strong",{children:"Valor M√≠nimo:"})," 1 (fijo)"]}),(0,m.jsxs)("div",{className:"calculated-max-value",children:[(0,m.jsx)("strong",{children:"Valor M√°ximo:"})," ",x," ","(calculado autom√°ticamente)"]})]}),I&&!I.isValid&&(0,m.jsx)(t.Notice,{status:"warning",isDismissible:!1,children:I.message}),y&&(0,m.jsxs)(t.Notice,{status:"info",isDismissible:!1,children:[(0,m.jsx)("strong",{children:"Modo Predefinido Activo:"}),' La configuraci√≥n de la escala est√° bloqueada porque est√°s usando "',T?.name,'". Desactiva "Usar valores personalizados" para editar manualmente.']})]}),(0,m.jsx)(U,{attributes:e,setAttributes:i,options:B,clientId:s})]}),(0,m.jsxs)("div",{...w,children:[l&&(0,m.jsx)("label",{htmlFor:j?`${se(j)}-label`:void 0,className:c?"required":void 0,children:S}),(0,m.jsx)("div",{className:"likert-scale likert-preview","data-scale":`${u}-${x}`,children:(0,m.jsx)("ul",{className:"likert-list",children:k.map((e,i)=>{const s=`${se(j)}-${e}`,o=N[i]||e.toString();return(0,m.jsx)("li",{className:"likert-item",children:(0,m.jsxs)("label",{htmlFor:s,className:"likert-label-wrapper",children:[(0,m.jsx)("input",{type:"radio",name:j,id:s,value:e,required:c,"data-required":c?"true":"false",disabled:!0}),(0,m.jsx)("span",{className:"likert-label-text",children:o})]})},e)})})}),ie(d),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})]})},save:function({attributes:e}){const{fieldKey:i,fieldName:s,label:o,required:t,helperText:r,minValue:n=1,labels:l,conditionalLogic:c,scaleVariation:d="custom"}=e,p=(e=>{if(!e||""===e.trim())return 5;const i=e.split(";").map(e=>e.trim()).filter(e=>""!==e);return i.length>0?i.length:1})(l),u=s&&""!==s.trim()?s.trim():i,f={className:"form-group eipsi-field eipsi-likert-field","data-field-name":u,"data-required":t?"true":"false","data-field-type":"likert","data-min":n,"data-max":p,"data-scale-variation":d};c&&c.enabled&&c.rules&&c.rules.length>0&&(f["data-conditional-logic"]=JSON.stringify(c));const h=a.useBlockProps.save(f),g=l?O(l):[],x=[];for(let e=n;e<=p;e++)x.push(e);return(0,m.jsxs)("div",{...h,children:[o&&(0,m.jsx)("label",{htmlFor:u?`${ae(u)}-label`:void 0,className:t?"required":void 0,children:o}),(0,m.jsx)("div",{className:"likert-scale","data-scale":`${n}-${p}`,children:(0,m.jsx)("ul",{className:"likert-list",children:x.map((e,i)=>{const s=`${ae(u)}-${e}`,o=g[i]||e.toString();return(0,m.jsx)("li",{className:"likert-item",children:(0,m.jsxs)("label",{htmlFor:s,className:"likert-label-wrapper",children:[(0,m.jsx)("input",{type:"radio",name:u,id:s,value:e,required:t,"data-required":t?"true":"false"}),(0,m.jsx)("span",{className:"likert-label-text",children:o})]})},e)})})}),oe(r),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})}});function te(e){const i=function(e,i=40){if("number"!=typeof e||Number.isNaN(e))return i;let s=e;return s>80&&(s=s/100*80),Math.min(Math.max(s,0),80)}(e);return Math.round(i/80*100)}const re={3:{100:[3,50,88],50:[20,50,70],0:[25,50,75]},4:{100:[3,30,70,88],50:[15,35,65,80],0:[25,37.5,62.5,75]},5:{100:[5,25,50,75,90],50:[15,28,50,70,80],0:[25,37.5,50,62.5,75]}};function ne(e,i,s){const o=function(e,i,s){if(1===i)return 50;if(2===i)return 0===e?7:90;if(i>=3&&i<=5){const o=re[i];let a=0,t=100,r=o[0]||o[Object.keys(o)[0]],n=o[100];s<=50?(a=0,t=50,r=o[0]||function(e){const i=[];for(let s=0;s<e;s++){const o=s/(e-1);i.push(25+37.5*o)}return i}(i),n=o[50]):(a=50,t=100,r=o[50],n=o[100]);const l=(s-a)/(t-a);return r[e]+(n[e]-r[e])*l}const o=5+20*(1-s/100);return o+e/(i-1)*(100-1.5*o-o)}(e,i,s),a=function(e,i){return 0===e?"translateX(-100%)":i>0&&e===i-1?"translateX(50%)":"translateX(-50%)"}(e,i),t=function(e,i){return 0===e?"left":i>0&&e===i-1?"right":"center"}(e,i);return{left:`${Math.round(o)}%`,transform:a,textAlign:t}}const le=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})},ce=(e,i=0)=>"number"!=typeof e||Number.isNaN(e)?i:e,de=(e,i,s)=>"number"!=typeof e||Number.isNaN(e)?(i+s)/2:s<=i?i:Math.min(Math.max(e,i),s),pe=e=>{if(!e||""===e.trim())return null;const i=e.split("\n");return(0,m.jsx)("p",{className:"field-helper",children:i.map((e,s)=>(0,m.jsxs)("span",{children:[e,s<i.length-1&&(0,m.jsx)("br",{})]},s))})};(0,o.registerBlockType)("eipsi/vas-slider",{edit:function({attributes:e,setAttributes:i,clientId:s}){const{fieldName:o,label:n,required:l,helperText:c,labels:d,minValue:u,maxValue:f,step:h,initialValue:g,showValue:x,labelFontSize:b,valueFontSize:_,boldLabels:y,showCurrentValue:v,valuePosition:j,labelAlignment:C}=e,w=o&&""!==o.trim()?o.trim():void 0,S=(0,a.useBlockProps)({className:"form-group eipsi-field eipsi-vas-slider-field"+("below"===j?" vas-value-below":""),"data-field-name":w,"data-required":l?"true":"false","data-field-type":"vas-slider","data-value-position":j||"above"}),N=n&&""!==n.trim()?n:(0,r.__)("VAS Slider","eipsi-forms"),k=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(w),I=h&&h>0?h:1,B=ce(u,0),T=ce(f,B+I),P=T>B?T:B+I,[F,A]=(0,p.useState)(de(ce(g,B),B,P));(0,p.useEffect)(()=>{const e=ce(g,B),s=de(e,B,P);s!==g&&i({initialValue:s})},[g,B,P,i]),(0,p.useEffect)(()=>{const e=ce(g,B),i=de(e,B,P);i!==F&&A(i)},[g,B,P,F]);const $=d?O(d):[],E=$.length>0?$:[`${B}`,`${P}`],z=void 0!==v?v:!1!==x,q=z&&k?`${k}-value`:void 0,L=(0,r.__)("Debe ser menor que el m√°ximo. Si lo igual√°s o super√°s, ajustamos el rango autom√°ticamente.","eipsi-forms"),M=(0,r.__)("Debe ser mayor que el m√≠nimo. Si lo igual√°s o baj√°s demasiado, movemos el m√≠nimo para mantener el slider usable.","eipsi-forms");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Field Settings","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.TextControl,{label:(0,r.__)("Field Name / Slug","eipsi-forms"),value:o||"",onChange:e=>i({fieldName:e}),help:(0,r.__)("Used as the input name attribute (e.g., pain_level)","eipsi-forms")}),(0,m.jsx)(t.TextControl,{label:(0,r.__)("Label","eipsi-forms"),value:n||"",onChange:e=>i({label:e})}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Required field","eipsi-forms"),checked:!!l,onChange:e=>i({required:!!e})}),(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Helper text","eipsi-forms"),value:c||"",onChange:e=>i({helperText:e}),help:(0,r.__)("Displayed below the field to provide additional guidance.","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("VAS Slider Options","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.TextareaControl,{label:(0,r.__)("Labels (separated by semicolon)","eipsi-forms"),value:d||"",onChange:e=>i({labels:R(e)}),help:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("strong",{children:(0,r.__)("Ingres√° los labels separados por punto y coma (;)","eipsi-forms")}),(0,m.jsx)("br",{}),(0,r.__)("Ejemplo: Nada; Poco; Bastante; Mucho; Extremadamente intenso","eipsi-forms"),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,r.__)("¬øQuer√©s que un label ocupe dos l√≠neas? Presion√° Shift+Enter dentro del label para dividir.","eipsi-forms"),(0,m.jsx)("br",{}),(0,r.__)("Los saltos de l√≠nea se respetan exactamente como los escribas.","eipsi-forms")]})}),(0,m.jsx)(t.__experimentalNumberControl,{label:(0,r.__)("Minimum Value","eipsi-forms"),value:u,onChange:e=>{const s=parseFloat(e);if(Number.isNaN(s))return;let o="number"!=typeof f||Number.isNaN(f)?s+I:f;s>=o&&(o=s+I);const a=de(ce(g,s),s,o),t=de(F,s,o);i({minValue:s,maxValue:o,initialValue:a}),A(t)},min:-1e3,max:1e3,step:"any",help:L}),(0,m.jsx)(t.__experimentalNumberControl,{label:(0,r.__)("Maximum Value","eipsi-forms"),value:f,onChange:e=>{const s=parseFloat(e);if(Number.isNaN(s))return;let o="number"!=typeof u||Number.isNaN(u)?s-I:u;s<=o&&(o=s-I);const a=de(ce(g,o),o,s),t=de(F,o,s);i({minValue:o,maxValue:s,initialValue:a}),A(t)},min:-1e3,max:1e3,step:"any",help:M}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Step","eipsi-forms"),value:h&&h>0?h:1,onChange:e=>{const s="number"==typeof e?e:parseFloat(e);Number.isNaN(s)||i({step:parseFloat((s>0?s:.1).toFixed(2))})},min:.1,max:10,step:.1,help:(0,r.__)("Increment for each slider movement","eipsi-forms")}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Initial Value","eipsi-forms"),value:"number"==typeof g?g:B,onChange:e=>{i({initialValue:e}),A(e)},min:B,max:P,step:I,help:(0,r.__)("Default slider position","eipsi-forms")})]}),(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("Appearance","eipsi-forms"),initialOpen:!0,children:[(0,m.jsxs)("div",{className:"eipsi-panel-section",children:[(0,m.jsx)("h3",{style:{fontSize:"13px",fontWeight:600,marginBottom:"12px"},children:(0,r.__)("Label Appearance","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Bold labels","eipsi-forms"),checked:!1!==y,onChange:e=>i({boldLabels:!!e}),help:(0,r.__)("Make label text bold","eipsi-forms")}),(0,m.jsx)(t.__experimentalUnitControl,{label:(0,r.__)("Label size","eipsi-forms"),value:`${b||16}px`,onChange:e=>{const s=parseInt(e,10)||16;i({labelFontSize:s})},min:12,max:36,step:1,units:[{value:"px",label:"px",default:16}],isUnitSelectTabbable:!1}),(0,m.jsx)(t.RangeControl,{label:(0,r.__)("Label Alignment","eipsi-forms"),value:te(C),onChange:e=>{const s=function(e){if("number"!=typeof e||Number.isNaN(e))return 40;const i=Math.min(Math.max(e,0),100);return Math.round(i/100*80)}(e);i({labelAlignment:s})},min:0,max:100,step:1,help:(0,r.__)("Expand (higher) or compress (lower) label spacing. 0‚Äì100 range.","eipsi-forms")})]}),(0,m.jsxs)("div",{className:"eipsi-panel-section",style:{marginTop:"20px",paddingTop:"20px",borderTop:"1px solid #e5e5e5"},children:[(0,m.jsx)("h3",{style:{fontSize:"13px",fontWeight:600,marginBottom:"12px"},children:(0,r.__)("Values","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Show selected value","eipsi-forms"),checked:z,onChange:e=>i({showCurrentValue:!!e}),help:(0,r.__)("Show the number selected by the user","eipsi-forms")}),z&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.SelectControl,{label:(0,r.__)("Value Position","eipsi-forms"),value:j||"above",options:[{label:(0,r.__)("Above slider","eipsi-forms"),value:"above"},{label:(0,r.__)("Below slider","eipsi-forms"),value:"below"}],onChange:e=>i({valuePosition:e})}),(0,m.jsx)(t.__experimentalUnitControl,{label:(0,r.__)("Value font size","eipsi-forms"),value:`${_||36}px`,onChange:e=>{const s=parseInt(e,10)||36;i({valueFontSize:s})},min:16,max:72,step:1,units:[{value:"px",label:"px",default:36}],isUnitSelectTabbable:!1})]})]})]}),(0,m.jsx)(t.PanelBody,{title:(0,r.__)("Conditional Logic","eipsi-forms"),initialOpen:!1,children:(0,m.jsx)(U,{attributes:e,setAttributes:i,clientId:s})})]}),(0,m.jsxs)("div",{...S,children:[N&&(0,m.jsx)("label",{className:l?"required":void 0,htmlFor:k,children:N}),(0,m.jsxs)("div",{className:`vas-slider-container${!1!==y?" vas-bold-labels":""}${"below"===j?" vas-value-below":""}`,style:{"--vas-label-size":`${b||16}px`,"--vas-value-size":`${_||36}px`},children:[(0,m.jsx)("div",{className:"vas-multi-labels","data-label-count":E.length,children:E.map((e,i)=>{const s=E.length,o=["vas-multi-label",("string"==typeof e?e:"").includes("\n")&&"has-manual-breaks"].filter(Boolean).join(" "),a=ne(i,s,te(C));return(0,m.jsx)("span",{className:o,style:a,children:e},`label-${i}`)})}),z&&(0,m.jsx)("div",{className:"vas-current-value-solo",id:q,children:F}),(0,m.jsx)("input",{type:"range",className:"vas-slider",min:B,max:P,step:I,value:F,onChange:e=>{const i=parseFloat(e.target.value);isNaN(i)||A(i)}})]}),le(c)]})]})},save:function({attributes:e}){const{fieldName:i,label:s,required:o,helperText:t,labels:r,minValue:n,maxValue:l,step:c,initialValue:d,showValue:p,labelFontSize:u,valueFontSize:f,showLabelContainers:h,boldLabels:g,showCurrentValue:x,valuePosition:b,conditionalLogic:_,labelAlignment:y}=e,v=i&&""!==i.trim()?i.trim():void 0,j={className:"form-group eipsi-field eipsi-vas-slider-field"+("below"===b?" vas-value-below":""),"data-field-name":v,"data-required":o?"true":"false","data-field-type":"vas-slider","data-value-position":b||"above"};_&&_.enabled&&_.rules&&_.rules.length>0&&(j["data-conditional-logic"]=JSON.stringify(_));const C=a.useBlockProps.save(j),w=(e=>{if(e&&""!==e.trim())return`field-${e.trim().replace(/\s+/g,"-").replace(/[^a-zA-Z0-9_-]/g,"-")}`})(v),S=c&&c>0?c:1,N="number"!=typeof n||Number.isNaN(n)?0:n,k="number"!=typeof l||Number.isNaN(l)?N+S:l,I=k>N?k:N+S,B="number"==typeof d&&!Number.isNaN(d)&&d>=N&&d<=I?d:Math.floor((N+I)/2),T=r?O(r):[],P=T.length>0?T:[`${N}`,`${I}`],F=void 0!==x?x:!1!==p,A=F&&w?`${w}-value`:void 0;return(0,m.jsxs)("div",{...C,children:[s&&(0,m.jsx)("label",{className:o?"required":void 0,htmlFor:w,children:s}),(0,m.jsxs)("div",{className:`vas-slider-container${h?" vas-show-label-containers":""}${!1!==g?" vas-bold-labels":""}${"below"===b?" vas-value-below":""}`,"data-scale":`${N}-${I}`,style:{"--vas-label-size":`${u||16}px`,"--vas-value-size":`${f||36}px`},children:[(0,m.jsx)("div",{className:"vas-multi-labels","data-label-count":P.length,children:P.map((e,i)=>{const s=P.length,o=["vas-multi-label",("string"==typeof e?e:"").includes("\n")&&"has-manual-breaks"].filter(Boolean).join(" "),a=ne(i,s,te(y));return(0,m.jsx)("span",{className:o,style:a,children:e},`label-${i}`)})}),F&&(0,m.jsx)("div",{className:"vas-current-value-solo",id:A,children:B}),(0,m.jsx)("input",{type:"range",name:v,id:w,className:"vas-slider",min:N,max:I,step:S,defaultValue:B,required:o,"data-required":o?"true":"false","data-show-value":F?"true":"false","data-touched":"false","aria-valuemin":N,"aria-valuemax":I,"aria-valuenow":B,"aria-labelledby":A})]}),pe(t),(0,m.jsx)("div",{className:"form-error","aria-live":"polite"})]})}});const me=window.wp.apiFetch;var ue=s.n(me);(0,o.registerBlockType)("eipsi/randomization",{edit:function({attributes:e,setAttributes:i}){const{randomizationId:s,enabled:o,formularios:n,method:l,manualAssignments:c,showPreview:d,showInstructions:u}=e,[f,h]=(0,p.useState)([]),[g,x]=(0,p.useState)(""),[b,_]=(0,p.useState)(""),[y,v]=(0,p.useState)(""),[j,C]=(0,p.useState)(!1),[w,S]=(0,p.useState)(!1),[N,k]=(0,p.useState)(!1);(0,p.useEffect)(()=>{C(!0),ue()({path:"/wp/v2/eipsi_form_template?per_page=100&status=publish"}).then(e=>{const i=e.map(e=>({id:String(e.id),label:e.title.rendered||`Formulario #${e.id}`}));h(i)}).catch(e=>{console.error("[EIPSI Randomization] Error loading forms:",e)}).finally(()=>{C(!1)})},[]);const I=e=>{if(0===e.length)return;const s=Math.floor(100/e.length),o=100%e.length,a=e.map((e,i)=>({...e,porcentaje:s+(i<o?1:0)}));i({formularios:a})},B=(0,a.useBlockProps)({className:"eipsi-randomization-block"}),T=n.reduce((e,i)=>e+(i.porcentaje||0),0);return(0,m.jsxs)("div",{...B,children:[(0,m.jsx)(a.InspectorControls,{children:(0,m.jsxs)(t.PanelBody,{title:(0,r.__)("‚öôÔ∏è Configuraci√≥n","eipsi-forms"),initialOpen:!0,children:[(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Activar Aleatorizaci√≥n","eipsi-forms"),checked:o,onChange:e=>{if(e&&!s){const s=`rand_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;i({enabled:e,randomizationId:s})}else i({enabled:e})},help:(0,r.__)("Cuando est√° activado, los participantes reciben formularios aleatorios","eipsi-forms")}),o&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(t.SelectControl,{label:(0,r.__)("M√©todo de Aleatorizaci√≥n","eipsi-forms"),value:l,options:[{label:(0,r.__)("Con seed reproducible","eipsi-forms"),value:"seeded"},{label:(0,r.__)("Random puro","eipsi-forms"),value:"pure-random"}],onChange:e=>i({method:e}),help:(0,r.__)("Con seed: misma asignaci√≥n para mismo participante. Random puro: puede cambiar en cada acceso.","eipsi-forms")}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Mostrar Vista Previa","eipsi-forms"),checked:d,onChange:e=>i({showPreview:e})}),(0,m.jsx)(t.ToggleControl,{label:(0,r.__)("Mostrar Instrucciones en Frontend","eipsi-forms"),checked:u,onChange:e=>i({showInstructions:e}),help:(0,r.__)("Muestra un disclaimer sobre la aleatorizaci√≥n","eipsi-forms")})]})]})}),(0,m.jsxs)(t.Card,{children:[(0,m.jsx)(t.CardHeader,{children:(0,m.jsx)("h2",{children:"üé≤ Configuraci√≥n de Aleatorizaci√≥n"})}),(0,m.jsx)(t.CardBody,{children:o?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h3",{children:(0,r.__)("Formularios para Aleatorizar","eipsi-forms")}),(0,m.jsxs)(t.Flex,{gap:2,style:{marginBottom:"1rem"},children:[(0,m.jsx)(t.FlexItem,{style:{flex:1},children:(0,m.jsx)(t.SelectControl,{value:g,options:[{label:(0,r.__)("Seleccionar formulario‚Ä¶","eipsi-forms"),value:""},...f.map(e=>({label:e.label,value:e.id}))],onChange:x,disabled:j})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.Button,{variant:"primary",onClick:()=>{if(!g)return;const e=f.find(e=>e.id===g);if(!e)return;if(n.some(e=>e.postId===parseInt(g)))return void alert((0,r.__)("Este formulario ya est√° en la lista","eipsi-forms"));const i={id:`form_${Date.now()}`,postId:parseInt(g),nombre:e.label,porcentaje:0},s=[...n,i];I(s),x("")},disabled:!g||j,children:(0,r.__)("‚ûï A√±adir","eipsi-forms")})})]}),j&&(0,m.jsx)(t.Notice,{status:"info",isDismissible:!1,children:(0,r.__)("Cargando formularios‚Ä¶","eipsi-forms")}),n.length>0&&(0,m.jsx)("div",{style:{marginBottom:"1rem",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden"},children:n.map(e=>(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1rem",borderBottom:"1px solid #f0f0f0",background:"#fafafa"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:e.nombre}),(0,m.jsxs)("span",{style:{marginLeft:"1rem",color:"#666",fontWeight:"bold"},children:[e.porcentaje,"%"]})]}),(0,m.jsx)(t.Button,{isDestructive:!0,isSmall:!0,onClick:()=>(e=>{const s=n.filter(i=>i.id!==e);s.length>0?I(s):i({formularios:[]})})(e.id),children:"‚úï"})]},e.id))}),n.length>0&&(0,m.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.9rem",fontWeight:"bold",padding:"0.5rem",background:100===T?"#e8f5e9":"#ffebee",color:100===T?"#2e7d32":"#c62828",borderRadius:"4px"},children:[(0,r.__)("Total:","eipsi-forms")," ",T,"%"," ",100===T?"‚úì":"‚ö†Ô∏è"]}),n.length<2&&(0,m.jsx)(t.Notice,{status:"warning",isDismissible:!1,children:(0,r.__)("Necesit√°s al menos 2 formularios para generar shortcode/link","eipsi-forms")}),(0,m.jsx)("hr",{style:{margin:"2rem 0",border:"none",borderTop:"2px solid #e0e0e0"}}),(0,m.jsx)("h3",{children:(0,r.__)("Asignaciones Manuales (Override √âtico)","eipsi-forms")}),(0,m.jsx)("p",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"1rem"},children:(0,r.__)("Asign√° participantes espec√≠ficos a formularios concretos. √ötil para casos especiales o balanceo manual.","eipsi-forms")}),(0,m.jsxs)(t.Flex,{gap:2,style:{marginBottom:"1rem"},children:[(0,m.jsx)(t.FlexItem,{style:{flex:1},children:(0,m.jsx)(t.TextControl,{type:"email",placeholder:(0,r.__)("Email del participante","eipsi-forms"),value:b,onChange:_})}),(0,m.jsx)(t.FlexItem,{style:{flex:1},children:(0,m.jsx)(t.SelectControl,{value:y,options:[{label:(0,r.__)("Seleccionar formulario‚Ä¶","eipsi-forms"),value:""},...f.map(e=>({label:e.label,value:e.id}))],onChange:v})}),(0,m.jsx)(t.FlexItem,{children:(0,m.jsx)(t.Button,{variant:"primary",onClick:()=>{if(!b||!y)return void alert((0,r.__)("Complet√° el email y seleccion√° un formulario","eipsi-forms"));const e=b.toLowerCase().trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return void alert((0,r.__)("Email inv√°lido","eipsi-forms"));if(c.some(i=>i.email===e))return void alert((0,r.__)("Ya existe una asignaci√≥n para este email","eipsi-forms"));const s=f.find(e=>e.id===y);if(!s)return;const o={email:e,formId:y,formName:s.label,timestamp:Date.now()};i({manualAssignments:[...c,o]}),_(""),v("")},disabled:!b||!y,children:(0,r.__)("‚ûï A√±adir","eipsi-forms")})})]}),c.length>0&&(0,m.jsx)("div",{style:{marginBottom:"1rem",border:"1px solid #ffc107",borderRadius:"4px",overflow:"hidden"},children:c.map(e=>(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1rem",borderBottom:"1px solid #fff8e1",background:"#fffbf0",borderLeft:"3px solid #ffc107"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("code",{style:{background:"#fff",padding:"2px 6px",borderRadius:"3px"},children:e.email}),(0,m.jsxs)("span",{style:{marginLeft:"1rem",color:"#666"},children:["‚Üí ",e.formName]})]}),(0,m.jsx)(t.Button,{isDestructive:!0,isSmall:!0,onClick:()=>{return s=e.email,void i({manualAssignments:c.filter(e=>e.email!==s)});var s},children:"‚úï"})]},e.email))}),n.length>=2&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("hr",{style:{margin:"2rem 0",border:"none",borderTop:"2px solid #e0e0e0"}}),(0,m.jsx)(t.Card,{style:{background:"#f0f7ff",border:"2px solid #2196f3"},children:(0,m.jsxs)(t.CardBody,{children:[(0,m.jsx)("h3",{style:{marginTop:0,color:"#1565c0"},children:(0,r.__)("üìã Generaci√≥n Autom√°tica","eipsi-forms")}),d&&(0,m.jsxs)("div",{style:{padding:"1rem",background:"white",border:"1px solid #ddd",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:[(0,m.jsx)("strong",{children:(0,r.__)("Vista Previa:","eipsi-forms")}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Aleatorizaci√≥n:"})," ",n.map(e=>`${e.nombre} (${e.porcentaje}%)`).join(" | ")]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"M√©todo:"})," ","seeded"===l?"Con seed reproducible":"Random puro"]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("strong",{children:"Asignaciones manuales:"})," ",c.length]})]}),(0,m.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,m.jsx)("h4",{style:{marginBottom:"0.5rem"},children:(0,r.__)("Shortcode (para insertar en posts/p√°ginas)","eipsi-forms")}),(0,m.jsxs)("code",{style:{display:"block",padding:"0.75rem",background:"#f5f5f5",borderRadius:"4px",marginBottom:"0.5rem",wordBreak:"break-all",fontSize:"0.9rem",border:"1px solid #ddd"},children:['[eipsi_randomization id="',s,'"]']}),(0,m.jsx)(t.Button,{variant:w?"primary":"secondary",onClick:()=>{if(n.length<2)return void alert((0,r.__)("Necesit√°s al menos 2 formularios configurados","eipsi-forms"));const e=`[eipsi_randomization id="${s}"]`;navigator.clipboard.writeText(e).then(()=>{S(!0),setTimeout(()=>S(!1),2e3)})},icon:w?"yes-alt":"clipboard",children:w?(0,r.__)("‚úì Copiado!","eipsi-forms"):(0,r.__)("üìã Copiar Shortcode","eipsi-forms")})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{style:{marginBottom:"0.5rem"},children:(0,r.__)("Link Directo","eipsi-forms")}),(0,m.jsxs)("code",{style:{display:"block",padding:"0.75rem",background:"#f5f5f5",borderRadius:"4px",marginBottom:"0.5rem",wordBreak:"break-all",fontSize:"0.9rem",border:"1px solid #ddd"},children:[window.location.origin,"/?eipsi_rand=",s]}),(0,m.jsx)(t.Button,{variant:N?"primary":"secondary",onClick:()=>{if(n.length<2)return void alert((0,r.__)("Necesit√°s al menos 2 formularios configurados","eipsi-forms"));const e=`${window.location.origin}/?eipsi_rand=${s}`;navigator.clipboard.writeText(e).then(()=>{k(!0),setTimeout(()=>k(!1),2e3)})},icon:N?"yes-alt":"admin-links",children:N?(0,r.__)("‚úì Copiado!","eipsi-forms"):(0,r.__)("üîó Copiar Link","eipsi-forms")})]})]})})]})]}):(0,m.jsx)(t.Notice,{status:"info",isDismissible:!1,children:(0,r.__)("La aleatorizaci√≥n est√° desactivada. Act√≠vala en el panel lateral para empezar.","eipsi-forms")})})]})]})},save:function({attributes:e}){const{randomizationId:i,enabled:s}=e;if(!s||!i)return null;const o=a.useBlockProps.save({className:"eipsi-randomization-wrapper","data-randomization-id":i});return(0,m.jsx)("div",{...o,children:`[eipsi_randomization id="${i}"]`})}}),s(655),s(667)},655:()=>{!function(){"use strict";if("undefined"==typeof window)return;const e="partial_responses",i=new Set(["form_id","form_action","ip_address","device","browser","os","screen_width","form_start_time","form_end_time","current_page","nonce","action","participant_id","session_id","eipsi_forms_nonce"]);class s{constructor(e,i){this.form=e,this.config=i||{},this.formId=this.getFormId(),this.participantId=this.getParticipantId(),this.sessionId=this.getSessionId(),this.autosaveTimer=null,this.db=null,this.pendingSync=!1,this.initialized=!1,this.completed=!1,this.hasResponses=!1,this.beforeUnloadHandler=null,this.inputDebounceId=null,this.init()}async init(){try{this.db=await this.openDB(),this.initialized=!0,await this.checkForPartialResponse(),this.setupAutosave(),this.setupBeforeUnload(),this.setupChangeListeners()}catch(e){window.console&&window.console.error&&window.console.error("[EIPSI Save & Continue] Initialization failed:",e)}}getFormId(){return this.form?.dataset?.formId||this.form?.querySelector('input[name="form_id"]')?.value||"default"}getParticipantId(){const e="eipsi_participant_id";let i=null;try{i=window.localStorage.getItem(e)}catch(e){i=null}if(!i){i=`p-${(crypto.randomUUID?crypto.randomUUID().replace(/-/g,""):`${Math.random().toString(36).substring(2)}${Date.now().toString(36)}`).substring(0,12)}`;try{window.localStorage.setItem(e,i)}catch(e){}}return i}getSessionId(){const e=`eipsi_session_${this.formId||"default"}`;let i=null;try{i=window.sessionStorage.getItem(e)}catch(e){i=null}if(!i){i=`sess-${Date.now()}-${Math.random().toString(36).substring(2,8)}`;try{window.sessionStorage.setItem(e,i)}catch(e){}}return i}openDB(){return window.indexedDB?new Promise((i,s)=>{const o=window.indexedDB.open("eipsi_forms",1);o.onerror=()=>s(new Error("IndexedDB unavailable")),o.onsuccess=()=>i(o.result),o.onupgradeneeded=i=>{const s=i.target.result;s.objectStoreNames.contains(e)||s.createObjectStore(e,{keyPath:["form_id","participant_id","session_id"]})}}):Promise.resolve(null)}async checkForPartialResponse(){const e=await this.loadFromServer();if(e&&e.found&&e.partial)return void this.showRecoveryPopup(e.partial);const i=await this.loadFromIDB();i&&this.showRecoveryPopup(i)}async loadFromServer(){if(!this.config.ajaxUrl)return null;try{const e=new FormData;e.append("action","eipsi_load_partial_response"),e.append("form_id",this.formId),e.append("participant_id",this.participantId),e.append("session_id",this.sessionId);const i=await fetch(this.config.ajaxUrl,{method:"POST",body:e,credentials:"same-origin"}),s=await i.json();return s.success?s.data:null}catch(e){return null}}async loadFromIDB(){return this.db?new Promise(i=>{const s=this.db.transaction([e],"readonly").objectStore(e),o=[this.formId,this.participantId,this.sessionId],a=s.get(o);a.onsuccess=()=>i(a.result||null),a.onerror=()=>i(null)}):null}showRecoveryPopup(e){if(document.querySelector(".eipsi-recovery-popup"))return;const i=e.updated_at||(new Date).toISOString(),s=new Date("string"==typeof i?i.replace(" ","T"):i),o=Number.isNaN(s.getTime())?"tu √∫ltima sesi√≥n":s.toLocaleString("es",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),a=document.createElement("div");a.className="eipsi-recovery-popup",a.setAttribute("data-modal-id",Date.now()),a.innerHTML=`\n                <div class="eipsi-recovery-overlay" aria-hidden="true"></div>\n                <div class="eipsi-recovery-modal" role="dialog" aria-live="polite">\n                    <h3>Continuar donde quedaste</h3>\n                    <p>Ten√©s respuestas guardadas del <strong>${o}</strong>.</p>\n                    <p>¬øQuer√©s continuar donde quedaste?</p>\n                    <div class="eipsi-recovery-buttons">\n                        <button type="button" class="eipsi-btn eipsi-btn-primary" data-action="continue">\n                            Continuar\n                        </button>\n                        <button type="button" class="eipsi-btn eipsi-btn-secondary" data-action="restart">\n                            Empezar de nuevo\n                        </button>\n                    </div>\n                </div>\n            `,document.body.appendChild(a);const t=a.querySelector('[data-action="continue"]'),r=a.querySelector('[data-action="restart"]');t&&t.addEventListener("click",async()=>{t.disabled=!0,t.textContent="Cargando...";try{await this.waitForFormReady(),await this.restorePartial(e),await this.ensureFormVisible(),await new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(e)})}),this.closeRecoveryPopup(a)}catch(e){this.config?.settings?.debug&&window.console?.error&&window.console.error("[EIPSI Save & Continue] Error al restaurar sesi√≥n:",e),this.forceFormVisible(),this.closeRecoveryPopup(a)}}),r&&r.addEventListener("click",async()=>{r.disabled=!0,r.textContent="Borrando...";try{await this.discardPartial(),this.forceFormVisible(),this.closeRecoveryPopup(a)}catch(e){this.config?.settings?.debug&&window.console?.error&&window.console.error("[EIPSI Save & Continue] Error al descartar sesi√≥n:",e),this.closeRecoveryPopup(a)}})}closeRecoveryPopup(e){if(!e||!e.parentNode)return;const i=e.querySelector(".eipsi-recovery-overlay");i&&(i.style.pointerEvents="none",i.style.opacity="0");const s=e.querySelector(".eipsi-recovery-modal");s&&(s.style.opacity="0"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},200)}waitForFormReady(){return new Promise(e=>{const i=Date.now(),s=()=>{if(Date.now()-i>1e4)return this.config?.settings?.debug&&window.console?.warn&&window.console.warn("[EIPSI Save & Continue] Timeout esperando formulario, continuando..."),void e();if(!this.form||!this.form.parentNode)return void setTimeout(s,100);const o=this.form.offsetHeight>0&&this.form.offsetWidth>0,a="none"!==this.form.style.display&&"hidden"!==this.form.style.visibility;o||a?e():setTimeout(s,100)};s()})}ensureFormVisible(){return new Promise(e=>{if(!this.form)return void e();this.form.classList.remove("hidden","eipsi-hidden","eipsi-form-hidden"),this.form.style.display="block",this.form.style.visibility="visible",this.form.style.opacity="1";const i=this.form.closest(".eipsi-form");i&&(i.classList.remove("hidden","eipsi-hidden","eipsi-form-hidden"),i.style.display="block",i.style.visibility="visible",i.style.opacity="1"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})})}forceFormVisible(){if(!this.form)return;this.form.style.setProperty("display","block","important"),this.form.style.setProperty("visibility","visible","important"),this.form.style.setProperty("opacity","1","important"),this.form.style.setProperty("pointer-events","auto","important");const e=this.form.closest(".eipsi-form");e&&(e.style.setProperty("display","block","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("pointer-events","auto","important"))}async restorePartial(e){const i=e.responses||{},s=e.page_index||1;if(Object.keys(i).forEach(e=>{this.setFieldValue(e,i[e])}),this.hasResponses=Object.keys(i).length>0,await new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(e)})}),window.EIPSIForms&&"function"==typeof window.EIPSIForms.setCurrentPage)try{window.EIPSIForms.setCurrentPage(this.form,s,{trackChange:!1}),await new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(e)})});const e=window.EIPSIForms.getNavigator(this.form);e&&e.reset&&(e.reset(),e.pushHistory(s))}catch(e){this.config?.settings?.debug&&window.console?.warn&&window.console.warn("[EIPSI Save & Continue] Error al establecer p√°gina:",e)}}setFieldValue(e,i){if(null==i)return;const s=this.form.querySelectorAll(`[name="${e}"]`);if(s.length>1)return void s.forEach(e=>{"radio"===e.type?e.checked=e.value===i:"checkbox"===e.type&&(Array.isArray(i)?e.checked=i.includes(e.value):e.checked=!0===i||"true"===i||e.value===i)});const o=window.CSS&&window.CSS.escape?CSS.escape(e):e.replace(/([ #.;?*+~'"^$\[\]()=>|/@])/g,"\\$1"),a=s[0]||this.form.querySelector(`[id="${o}"]`);if(!a)return;if("checkbox"===a.type)return void(Array.isArray(i)?a.checked=i.includes(a.value):a.checked=!0===i||"true"===i||a.value===i);if("SELECT"===a.tagName&&a.multiple&&Array.isArray(i))return void Array.from(a.options).forEach(e=>{e.selected=i.includes(e.value)});const t=Array.isArray(i)?i[0]:i;a.value=t,"range"===a.type&&a.dispatchEvent(new Event("input",{bubbles:!0}))}async discardPartial(){await this.clearFromIDB(),await this.discardFromServer();try{const e=`eipsi_session_${this.formId||"default"}`;window.sessionStorage.removeItem(e);const i=`eipsi_form_responses_${this.formId||"default"}`;window.localStorage.removeItem(i)}catch(e){}this.hasResponses=!1,this.completed=!1}async clearFromIDB(){return this.db?new Promise(i=>{const s=this.db.transaction([e],"readwrite").objectStore(e),o=[this.formId,this.participantId,this.sessionId],a=s.delete(o);a.onsuccess=()=>{this.hasResponses=!1,i(!0)},a.onerror=()=>i(!1)}):(this.hasResponses=!1,!1)}async discardFromServer(){if(this.config.ajaxUrl)try{const e=new URLSearchParams;e.append("action","eipsi_discard_partial_response"),e.append("form_id",this.formId),e.append("participant_id",this.participantId),e.append("session_id",this.sessionId),await fetch(this.config.ajaxUrl,{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},keepalive:!0,credentials:"same-origin"})}catch(e){}}setupAutosave(){this.autosaveTimer&&clearInterval(this.autosaveTimer),this.autosaveTimer=window.setInterval(()=>{this.savePartial("auto")},3e4)}setupBeforeUnload(){this.beforeUnloadHandler||(this.beforeUnloadHandler=e=>{if(!this.completed&&(this.savePartialSync(),this.hasResponses)){const i="Tus respuestas se est√°n guardando. Pod√©s volver cuando quieras.";return e.preventDefault(),e.returnValue=i,i}},window.addEventListener("beforeunload",this.beforeUnloadHandler))}removeBeforeUnload(){this.beforeUnloadHandler&&(window.removeEventListener("beforeunload",this.beforeUnloadHandler),this.beforeUnloadHandler=null)}setupChangeListeners(){this.form.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("input",()=>this.handleFieldInput()),e.addEventListener("change",()=>this.savePartial("field-change"))})}handleFieldInput(){this.completed||(this.inputDebounceId&&clearTimeout(this.inputDebounceId),this.inputDebounceId=window.setTimeout(()=>{this.saveToIDB()},800))}async savePartial(e="manual"){if(!this.completed&&!this.pendingSync){this.pendingSync=!0;try{const i=this.collectResponses(),s=this.getCurrentPage();this.hasResponses=Object.keys(i).length>0,this.config?.settings?.debug&&window.console&&"function"==typeof window.console.debug&&window.console.debug("[EIPSI Save & Continue] Guardando borrador",{trigger:e,page:s,hasResponses:this.hasResponses}),await this.saveToIDB(i,s),await this.saveToServer(i,s)}catch(e){window.console&&window.console.warn&&window.console.warn("[EIPSI Save & Continue] Save failed:",e)}finally{this.pendingSync=!1}}}savePartialSync(){if(this.completed||!this.config.ajaxUrl)return;const e=this.collectResponses(),i=this.getCurrentPage(),s=new URLSearchParams;s.append("action","eipsi_save_partial_response"),s.append("form_id",this.formId),s.append("participant_id",this.participantId),s.append("session_id",this.sessionId),s.append("page_index",i),s.append("responses",JSON.stringify(e));const o=s.toString();if(navigator.sendBeacon){const e=new Blob([o],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(this.config.ajaxUrl,e)}else fetch(this.config.ajaxUrl,{method:"POST",body:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},keepalive:!0,credentials:"same-origin"}).catch(()=>{});this.saveToIDB(e,i)}collectResponses(){const e={};return new FormData(this.form).forEach((s,o)=>{if(i.has(o))return;if(s instanceof File)return;const a="string"==typeof s?s:`${s}`;void 0!==e[o]?(Array.isArray(e[o])||(e[o]=[e[o]]),e[o].push(a)):e[o]=a}),e}getCurrentPage(){const e=this.form.querySelector(".eipsi-current-page");return e&&parseInt(e.value,10)||1}async saveToIDB(i=null,s=null){if(!this.db)return!1;const o={form_id:this.formId,participant_id:this.participantId,session_id:this.sessionId,page_index:s||this.getCurrentPage(),responses:i||this.collectResponses(),updated_at:(new Date).toISOString()};return new Promise(i=>{const s=this.db.transaction([e],"readwrite").objectStore(e).put(o);s.onsuccess=()=>i(!0),s.onerror=()=>i(!1)})}async saveToServer(e=null,i=null){if(!this.config.ajaxUrl)return!1;try{const s=new FormData;s.append("action","eipsi_save_partial_response"),s.append("form_id",this.formId),s.append("participant_id",this.participantId),s.append("session_id",this.sessionId),s.append("page_index",i||this.getCurrentPage()),s.append("responses",JSON.stringify(e||this.collectResponses()));const o=await fetch(this.config.ajaxUrl,{method:"POST",body:s,keepalive:!0,credentials:"same-origin"});return!!(await o.json()).success}catch(e){return!1}}handleFormCompleted(){this.completed=!0,this.clearFromIDB(),this.discardFromServer(),this.removeBeforeUnload();try{const e=`eipsi_session_${this.formId||"default"}`;window.sessionStorage.removeItem(e);const i=`eipsi_form_responses_${this.formId||"default"}`;window.localStorage.removeItem(i)}catch(e){}this.autosaveTimer&&(clearInterval(this.autosaveTimer),this.autosaveTimer=null),this.inputDebounceId&&(clearTimeout(this.inputDebounceId),this.inputDebounceId=null)}destroy(){this.handleFormCompleted(),this.db&&(this.db.close(),this.db=null)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".eipsi-form form, .eipsi-form form").forEach(e=>{if(!window.eipsiFormsConfig||e.eipsiSaveContinue)return;const i=new s(e,window.eipsiFormsConfig);e.eipsiSaveContinue=i})}),window.EIPSISaveContinue=s}()},667:()=>{!function(){"use strict";async function e(){const e=new URLSearchParams(window.location.search).get("eipsi_token");if(e){const s=await async function(e){try{const s=await fetch(window.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"eipsi_validate_reminder_token",token:e})}),a=await s.json();if(a.success&&a.data&&a.data.valid){const{email:e,form_id:s,take:t,seed:r}=a.data;sessionStorage.setItem("eipsi_assigned_form",String(s)),sessionStorage.setItem("eipsi_seed",r||""),sessionStorage.setItem("eipsi_email",e||""),sessionStorage.setItem("eipsi_take",String(t)),sessionStorage.setItem("eipsi_random_type","token_auto_login"),console.log("[EIPSI Random] Token validated successfully");const n=i();return String(s)!==String(n)&&o(s,r),!0}return console.warn("[EIPSI Random] Token invalid:",a.data?a.data.message:"Unknown error"),a.data&&a.data.message&&console.error("[EIPSI Random]",a.data.message),!1}catch(e){return console.error("[EIPSI Random] Token validation error:",e),!1}}(e);if(s)return}const a=sessionStorage.getItem("eipsi_assigned_form"),t=sessionStorage.getItem("eipsi_seed");if(a&&t){const e=i();return String(a)!==String(e)?void o(a,t):void 0}const r=document.querySelector(".vas-form, .vas-dinamico-form");if(!r)return;const n=r.dataset.formId||s();if(!n)return;const l=await async function(){if(window.eipsiParticipantEmail)return window.eipsiParticipantEmail;try{const e=window.localStorage.getItem("eipsi_participant_email");if(e)return e}catch(e){}const e=document.querySelector('input[type="email"]');return e&&e.value?e.value:null}(),c=getParticipantIdFromStorage();if(l||c)try{const e={action:"eipsi_random_assign",form_id:n,nonce:window.eipsiNonce||window.eipsiRandomNonce||""};l?e.email=l:c&&(e.participant_id=c);const i=await fetch(window.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}),s=await i.json();if(s.success&&s.data){const{formId:e,seed:i,type:a}=s.data;sessionStorage.setItem("eipsi_assigned_form",String(e)),sessionStorage.setItem("eipsi_seed",i||""),sessionStorage.setItem("eipsi_random_type",a||"random"),String(e)!==String(n)&&o(e,i)}}catch(e){console.error("[EIPSI Random] Error:",e)}}function i(){const e=document.querySelector(".vas-form, .vas-dinamico-form");return e&&e.dataset.formId?e.dataset.formId:s()}function s(){return new URLSearchParams(window.location.search).get("form_id")||""}function o(e,i){const s=window.location.href.split("?")[0],o=new URLSearchParams;e&&o.set("form_id",String(e)),i&&o.set("eipsi_seed",i),o.set("eipsi_assigned","1"),window.location.href=s+"?"+o.toString()}function a(){return"1"===new URLSearchParams(window.location.search).get("eipsi_assigned")}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){(new URLSearchParams(window.location.search).has("eipsi_random")||a())&&e()}):(new URLSearchParams(window.location.search).has("eipsi_random")||a())&&e(),window.EIPSIRandomization={init:e,getAssignment:()=>({formId:sessionStorage.getItem("eipsi_assigned_form"),seed:sessionStorage.getItem("eipsi_seed"),type:sessionStorage.getItem("eipsi_random_type")}),clearAssignment(){sessionStorage.removeItem("eipsi_assigned_form"),sessionStorage.removeItem("eipsi_seed"),sessionStorage.removeItem("eipsi_random_type")}})}()},679:(e,i,s)=>{"use strict";function o(e){if(!e||"string"!=typeof e)return e;const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>i[e])}function a(e){return e&&"string"==typeof e?e=(e=(e=(e=(e=o(e)).replace(/\*_([^*_]+?)_\*/g,"<strong><em>$1</em></strong>")).replace(/_\*([^*_]+?)\*_/g,"<em><strong>$1</strong></em>")).replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<strong>$1</strong>")).replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"):e||""}function t(e){if(!e||"string"!=typeof e)return{valid:!0};const i=(e.match(/\*/g)||[]).length,s=(e.match(/_/g)||[]).length,o=[];return i%2!=0&&o.push(`Asteriscos desparejados: ${i} total`),s%2!=0&&o.push(`Guiones bajos desparejados: ${s} total`),o.length>0?{valid:!1,error:o.join(", ")}:{valid:!0}}s.d(i,{Mg:()=>t,VV:()=>a}),(e=s.hmd(e)).exports&&(e.exports={parseConsentMarkdown:a,escapeHtml:o,validateConsentMarkdown:t})}},s={};function o(e){var a=s[e];if(void 0!==a)return a.exports;var t=s[e]={id:e,loaded:!1,exports:{}};return i[e](t,t.exports,o),t.loaded=!0,t.exports}o.m=i,e=[],o.O=(i,s,a,t)=>{if(!s){var r=1/0;for(d=0;d<e.length;d++){for(var[s,a,t]=e[d],n=!0,l=0;l<s.length;l++)(!1&t||r>=t)&&Object.keys(o.O).every(e=>o.O[e](s[l]))?s.splice(l--,1):(n=!1,t<r&&(r=t));if(n){e.splice(d--,1);var c=a();void 0!==c&&(i=c)}}return i}t=t||0;for(var d=e.length;d>0&&e[d-1][2]>t;d--)e[d]=e[d-1];e[d]=[s,a,t]},o.n=e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return o.d(i,{a:i}),i},o.d=(e,i)=>{for(var s in i)o.o(i,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={57:0,350:0};o.O.j=i=>0===e[i];var i=(i,s)=>{var a,t,[r,n,l]=s,c=0;if(r.some(i=>0!==e[i])){for(a in n)o.o(n,a)&&(o.m[a]=n[a]);if(l)var d=l(o)}for(i&&i(s);c<r.length;c++)t=r[c],o.o(e,t)&&e[t]&&e[t][0](),e[t]=0;return o.O(d)},s=globalThis.webpackChunkeipsi_forms=globalThis.webpackChunkeipsi_forms||[];s.forEach(i.bind(null,0)),s.push=i.bind(null,s.push.bind(s))})();var a=o.O(void 0,[350],()=>o(348));a=o.O(a)})();